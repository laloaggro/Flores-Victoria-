# Nixpacks configuration for admin-dashboard-service
# Root Directory should be set to 'microservices' (not 'microservices/admin-dashboard-service')
[phases.setup]
nixPkgs = ['nodejs']

[phases.install]
cmds = [
  # Install shared module dependencies
  'cd shared && npm install --production',
  # Install admin-dashboard-service dependencies
  'cd admin-dashboard-service && npm ci',
  # Copy shared module into admin-dashboard-service node_modules
  'cd admin-dashboard-service && mkdir -p node_modules/@flores-victoria',
  'cd admin-dashboard-service && cp -r ../shared node_modules/@flores-victoria/'
]

[start]
# Use server.simple.js to avoid complex shared dependencies
cmd = 'cd admin-dashboard-service && node src/server.simple.js'
