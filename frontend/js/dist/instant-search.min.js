!function(){"use strict";class e{constructor(e={}){this.config={searchInputId:"searchInput",clearButtonId:"clearSearch",resultsContainerId:"products-container",debounceDelay:300,minChars:2,maxHistoryItems:10,highlightClass:"search-highlight",noResultsMessage:"No se encontraron productos que coincidan con tu búsqueda",searchFields:["name","description","category","tags"],enableHistory:!0,enableKeyboardNav:!0,enableAnalytics:!0,...e},this.searchInput=null,this.clearButton=null,this.resultsContainer=null,this.debounceTimer=null,this.products=[],this.filteredProducts=[],this.currentQuery="",this.selectedIndex=-1,this.searchHistory=[],this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup()}setup(){this.searchInput=document.getElementById(this.config.searchInputId),this.clearButton=document.getElementById(this.config.clearButtonId),this.resultsContainer=document.getElementById(this.config.resultsContainerId),this.searchInput?(this.config.enableHistory&&this.loadSearchHistory(),this.attachEventListeners(),this.createSearchFeedback()):console.warn("InstantSearch: Input de búsqueda no encontrado")}attachEventListeners(){this.searchInput.addEventListener("input",e=>{this.handleSearchInput(e.target.value)}),this.clearButton&&this.clearButton.addEventListener("click",()=>{this.clearSearch()}),this.config.enableKeyboardNav&&this.searchInput.addEventListener("keydown",e=>{this.handleKeyboardNavigation(e)}),this.searchInput.addEventListener("focus",()=>{this.searchInput.parentElement?.classList.add("search-focused"),this.config.enableHistory&&""===this.currentQuery&&this.showSearchHistory()}),this.searchInput.addEventListener("blur",()=>{setTimeout(()=>{this.searchInput.parentElement?.classList.remove("search-focused")},200)})}handleSearchInput(e){if(this.debounceTimer&&clearTimeout(this.debounceTimer),this.clearButton&&(this.clearButton.style.display=e.length>0?"flex":"none"),0===e.length)return this.currentQuery="",void this.resetSearch();this.showSearchIndicator(),this.debounceTimer=setTimeout(()=>{this.performSearch(e)},this.config.debounceDelay)}performSearch(e){this.currentQuery=e,e.length<this.config.minChars?this.hideSearchIndicator():(window.productCatalogInstance&&(this.products=window.productCatalogInstance.allProducts||[]),this.filteredProducts=this.filterProducts(e),this.displayResults(),this.updateResultsCount(this.filteredProducts.length),this.hideSearchIndicator(),this.config.enableHistory&&this.filteredProducts.length>0&&this.saveToHistory(e),this.config.enableAnalytics&&window.FloresVictoriaAnalytics&&window.FloresVictoriaAnalytics.trackSearch(e,this.filteredProducts.length))}filterProducts(e){const t=this.normalizeString(e).split(/\s+/).filter(e=>e.length>0);return this.products.filter(e=>this.config.searchFields.some(s=>{const n=this.getNestedValue(e,s);if(!n)return!1;const r=this.normalizeString(String(n));return t.every(e=>r.includes(e))}))}displayResults(){this.resultsContainer&&(this.resultsContainer.innerHTML="",0!==this.filteredProducts.length?(this.filteredProducts.forEach((e,t)=>{const s=this.createProductCard(e,t);this.resultsContainer.appendChild(s)}),this.animateResults()):this.showNoResults())}createProductCard(e,t){const s=document.createElement("div");s.className="product-card reveal-scale",s.dataset.productId=e.id,s.style.animationDelay=.05*t+"s";const n=this.highlightText(e.name,this.currentQuery),r=this.highlightText(e.description||"",this.currentQuery);return s.innerHTML=`\n <div class="product-image-wrapper">\n <img src="${e.image||"/images/products/placeholder.jpg"}" \n alt="${e.name}"\n class="product-image lazy-load"\n loading="lazy">\n <div class="product-badge">${e.badge||"Nuevo"}</div>\n <button class="wishlist-btn" onclick="addToWishlist(${e.id})" title="Agregar a favoritos">\n <i class="far fa-heart"></i>\n </button>\n </div>\n <div class="product-info">\n <span class="product-category">${e.category}</span>\n <h3 class="product-title">${n}</h3>\n <p class="product-description">${r}</p>\n <div class="product-rating">\n ${'<i class="fas fa-star"></i>'.repeat(e.rating||5)}\n <span class="rating-count">(${e.reviews||0})</span>\n </div>\n <div class="product-footer">\n <span class="product-price">$${e.price.toLocaleString("es-MX")}</span>\n <div class="product-actions">\n <button class="btn-action" onclick="viewProduct(${e.id})" title="Ver detalles">\n <i class="fas fa-eye"></i>\n </button>\n <button class="btn-primary" onclick="addToCart(${e.id})">\n <i class="fas fa-shopping-cart"></i> Agregar\n </button>\n </div>\n </div>\n </div>\n `,s}highlightText(e,t){if(!t||t.length<this.config.minChars)return e;const s=this.normalizeString(t).split(/\s+/).filter(e=>e.length>0);let n=e;return s.forEach(e=>{if(e.length<2)return;const t=new RegExp(`(${this.escapeRegex(e)})`,"gi");n=n.replace(t,`<mark class="${this.config.highlightClass}">$1</mark>`)}),n}showNoResults(){this.resultsContainer&&(this.resultsContainer.innerHTML=`\n <div class="no-results">\n <div class="no-results-icon">\n <i class="fas fa-search"></i>\n </div>\n <h3>No se encontraron resultados</h3>\n <p>${this.config.noResultsMessage}</p>\n <p class="no-results-query">Búsqueda: <strong>"${this.currentQuery}"</strong></p>\n <button class="btn-secondary" onclick="window.instantSearchInstance.clearSearch()">\n Limpiar búsqueda\n </button>\n </div>\n `)}createSearchFeedback(){if(!document.getElementById("search-results-count")){const e=this.searchInput.parentElement,t=document.createElement("div");t.id="search-results-count",t.className="search-results-count",t.style.display="none",e.insertAdjacentElement("afterend",t)}if(!document.getElementById("search-indicator")){const e=this.searchInput.parentElement,t=document.createElement("div");t.id="search-indicator",t.className="search-indicator",t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Buscando...',t.style.display="none",e.insertAdjacentElement("afterend",t)}}updateResultsCount(e){const t=document.getElementById("search-results-count");t&&(this.currentQuery.length>=this.config.minChars?(t.textContent=`${e} ${1===e?"resultado encontrado":"resultados encontrados"}`,t.style.display="block",t.style.animation="fadeInUp 0.3s ease"):t.style.display="none")}showSearchIndicator(){const e=document.getElementById("search-indicator");e&&(e.style.display="flex")}hideSearchIndicator(){const e=document.getElementById("search-indicator");e&&(e.style.display="none")}animateResults(){this.resultsContainer.querySelectorAll(".product-card").forEach((e,t)=>{setTimeout(()=>{e.classList.add("visible")},50*t)})}handleKeyboardNavigation(e){const t=e.key;if("Escape"===t)this.clearSearch(),this.searchInput.blur(),e.preventDefault();else if("ArrowDown"===t||"ArrowUp"===t){const s=Array.from(this.resultsContainer.querySelectorAll(".product-card"));if(0===s.length)return;e.preventDefault(),this.selectedIndex>=0&&s[this.selectedIndex]&&s[this.selectedIndex].classList.remove("keyboard-selected"),this.selectedIndex="ArrowDown"===t?(this.selectedIndex+1)%s.length:this.selectedIndex<=0?s.length-1:this.selectedIndex-1;const n=s[this.selectedIndex];n.classList.add("keyboard-selected"),n.scrollIntoView({behavior:"smooth",block:"nearest"})}else if("Enter"===t&&this.selectedIndex>=0){const t=Array.from(this.resultsContainer.querySelectorAll(".product-card"))[this.selectedIndex];if(t){parseInt(t.dataset.productId);const e=t.querySelector(".btn-primary");e&&e.click()}e.preventDefault()}}clearSearch(){this.searchInput.value="",this.currentQuery="",this.selectedIndex=-1,this.clearButton&&(this.clearButton.style.display="none"),this.resetSearch(),this.searchInput.focus()}resetSearch(){window.productCatalogInstance&&window.productCatalogInstance.filterProducts();const e=document.getElementById("search-results-count");e&&(e.style.display="none")}normalizeString(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getNestedValue(e,t){return t.split(".").reduce((e,t)=>e&&e[t],e)}loadSearchHistory(){const e=localStorage.getItem("searchHistory");this.searchHistory=e?JSON.parse(e):[]}saveToHistory(e){this.searchHistory=this.searchHistory.filter(t=>t!==e),this.searchHistory.unshift(e),this.searchHistory.length>this.config.maxHistoryItems&&(this.searchHistory=this.searchHistory.slice(0,this.config.maxHistoryItems)),localStorage.setItem("searchHistory",JSON.stringify(this.searchHistory))}showSearchHistory(){this.searchHistory.length}search(e){this.searchInput.value=e,this.performSearch(e)}clear(){this.clearSearch()}getResults(){return this.filteredProducts}destroy(){this.debounceTimer&&clearTimeout(this.debounceTimer)}}window.InstantSearch=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.getElementById("searchInput")&&(window.instantSearchInstance=new e)}):document.getElementById("searchInput")&&(window.instantSearchInstance=new e)}();
//# sourceMappingURL=instant-search.min.js.map