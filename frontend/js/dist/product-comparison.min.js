!function(){"use strict";window.ProductComparison=class{constructor(e,t={}){this.products=e||[],this.config={maxProducts:4,minProducts:2,storageKey:"floresVictoriaComparison",...t},this.selectedProducts=[],this.loadFromStorage(),this.init()}init(){this.injectHTML(),this.attachEventListeners(),this.updateFloatingBar()}injectHTML(){if(document.getElementById("comparisonFloatingBar"))return;const e=`\n \x3c!-- Barra flotante de comparación --\x3e\n <div class="comparison-floating-bar" id="comparisonFloatingBar" style="display: none;">\n <div class="comparison-bar-content">\n <div class="comparison-bar-header">\n <h4>\n <i class="fas fa-balance-scale"></i>\n Comparar Productos (<span id="comparisonCount">0</span>/${this.config.maxProducts})\n </h4>\n <button class="btn-clear-comparison" id="btnClearComparison" title="Limpiar todo">\n <i class="fas fa-trash"></i>\n </button>\n </div>\n <div class="comparison-bar-products" id="comparisonBarProducts">\n \x3c!-- Productos seleccionados --\x3e\n </div>\n <div class="comparison-bar-actions">\n <button class="btn-compare" id="btnCompare" disabled>\n <i class="fas fa-eye"></i> Comparar Ahora\n </button>\n </div>\n </div>\n </div>\n\n \x3c!-- Modal de comparación --\x3e\n <div class="comparison-modal" id="comparisonModal">\n <div class="comparison-modal-overlay" id="comparisonModalOverlay"></div>\n <div class="comparison-modal-content">\n <div class="comparison-modal-header">\n <h3>\n <i class="fas fa-balance-scale"></i>\n Comparación de Productos\n </h3>\n <button class="btn-close-modal" id="btnCloseModal">\n <i class="fas fa-times"></i>\n </button>\n </div>\n <div class="comparison-modal-body" id="comparisonModalBody">\n \x3c!-- Tabla de comparación --\x3e\n </div>\n </div>\n </div>\n `;document.body.insertAdjacentHTML("beforeend",e)}attachEventListeners(){const e=document.getElementById("btnClearComparison");e&&e.addEventListener("click",()=>this.clearAll());const t=document.getElementById("btnCompare");t&&t.addEventListener("click",()=>this.showComparisonModal());const o=document.getElementById("btnCloseModal"),a=document.getElementById("comparisonModalOverlay");o&&o.addEventListener("click",()=>this.closeModal()),a&&a.addEventListener("click",()=>this.closeModal()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeModal()}),this.makeDraggable()}makeDraggable(){const e=document.getElementById("comparisonFloatingBar");if(!e)return;let t,o,a,s,n=!1,i=0,c=0;const r=e.querySelector(".comparison-bar-header");function d(t){t.target.closest("button")||("touchstart"===t.type?(a=t.touches[0].clientX-i,s=t.touches[0].clientY-c):(a=t.clientX-i,s=t.clientY-c),n=!0,e.classList.add("dragging"),e.style.transition="none",e.style.animation="none")}function l(r){if(!n)return;r.preventDefault(),"touchmove"===r.type?(t=r.touches[0].clientX-a,o=r.touches[0].clientY-s):(t=r.clientX-a,o=r.clientY-s),i=t,c=o;const d=e.getBoundingClientRect(),l=window.innerWidth-d.width,m=-(window.innerHeight-d.height);i=Math.max(0,Math.min(i,l)),c=Math.max(m,Math.min(c,0)),function(e,t,o){if(!o.dataset.positioned){const e=o.getBoundingClientRect();o.style.left=`${e.left}px`,o.style.bottom=window.innerHeight-e.bottom+"px",o.style.right="auto",o.dataset.positioned="true"}o.style.left=`${e}px`,o.style.bottom=-t+"px"}(i,c,e)}function m(){n&&(n=!1,e.classList.remove("dragging"),a=t,s=o,e.style.transition="transform 0.3s ease, box-shadow 0.3s ease")}r&&(r.addEventListener("mousedown",d),document.addEventListener("mousemove",l),document.addEventListener("mouseup",m),r.addEventListener("touchstart",d),document.addEventListener("touchmove",l),document.addEventListener("touchend",m))}addProduct(e){return this.selectedProducts.length>=this.config.maxProducts?(this.showToast(`Solo puedes comparar hasta ${this.config.maxProducts} productos a la vez`,"warning"),!1):!this.selectedProducts.includes(e)&&(this.selectedProducts.push(e),this.saveToStorage(),this.updateFloatingBar(),this.updateCheckboxes(),this.showToast("Producto agregado a la comparación","success"),!0)}removeProduct(e){const t=this.selectedProducts.indexOf(e);t>-1&&(this.selectedProducts.splice(t,1),this.saveToStorage(),this.updateFloatingBar(),this.updateCheckboxes(),this.showToast("Producto removido de la comparación","info"))}clearAll(){0!==this.selectedProducts.length&&confirm("¿Deseas eliminar todos los productos de la comparación?")&&(this.selectedProducts=[],this.saveToStorage(),this.updateFloatingBar(),this.updateCheckboxes(),this.showToast("Comparación limpiada","info"))}updateFloatingBar(){const e=document.getElementById("comparisonFloatingBar"),t=document.getElementById("comparisonCount"),o=document.getElementById("comparisonBarProducts"),a=document.getElementById("btnCompare");e&&t&&o&&a&&(t.textContent=this.selectedProducts.length,0!==this.selectedProducts.length?(e.style.display="flex",a.disabled=this.selectedProducts.length<this.config.minProducts,o.innerHTML=this.selectedProducts.map(e=>{const t=this.products.find(t=>t.id===e);if(!t)return"";const o=t.image_url||t.image||"/images/placeholder.svg";return`\n <div class="comparison-bar-product" data-product-id="${e}">\n <img src="${o}" alt="${t.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'80\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'80\\' height=\\'80\\'/%3E%3Ctext fill=\\'%23999\\' x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' font-size=\\'12\\'%3E%3C/text%3E%3C/svg%3E';">\n <button class="btn-remove-product" onclick="window.productComparisonInstance.removeProduct(${e})" title="Quitar de comparación">\n <i class="fas fa-times"></i>\n </button>\n </div>\n `}).join("")):e.style.display="none")}updateCheckboxes(){document.querySelectorAll(".comparison-checkbox").forEach(e=>{const t=parseInt(e.dataset.productId);e.checked=this.selectedProducts.includes(t)})}showComparisonModal(){if(this.selectedProducts.length<this.config.minProducts)return void this.showToast(`Selecciona al menos ${this.config.minProducts} productos para comparar`,"warning");const e=document.getElementById("comparisonModal"),t=document.getElementById("comparisonModalBody");if(!e||!t)return;const o=this.selectedProducts.map(e=>this.products.find(t=>t.id===e)).filter(e=>e);t.innerHTML=this.renderComparisonTable(o),e.classList.add("active"),document.body.style.overflow="hidden"}closeModal(){const e=document.getElementById("comparisonModal");e&&(e.classList.remove("active"),document.body.style.overflow="")}renderComparisonTable(e){if(0===e.length)return"<p>No hay productos para comparar</p>";return`\n <div class="comparison-table-wrapper">\n <table class="comparison-table">\n <thead>\n <tr>\n <th class="feature-column">Característica</th>\n ${e.map(e=>`\n <th class="product-column">\n <button class="btn-remove-from-comparison" \n onclick="window.productComparisonInstance.removeProduct(${e.id})">\n <i class="fas fa-times"></i>\n </button>\n </th>\n `).join("")}\n </tr>\n </thead>\n <tbody>\n ${[{key:"image",label:"Imagen",type:"image"},{key:"name",label:"Nombre",type:"text"},{key:"price",label:"Precio",type:"price"},{key:"original_price",label:"Precio Original",type:"price"},{key:"size",label:"Tamaño",type:"text"},{key:"color",label:"Color",type:"text"},{key:"category",label:"Categoría",type:"category"},{key:"type",label:"Tipo",type:"text"},{key:"description",label:"Descripción",type:"text"},{key:"featured",label:"Destacado",type:"badge"},{key:"bestseller",label:"Más Vendido",type:"badge"},{key:"new",label:"Nuevo",type:"badge"}].map(t=>e.some(e=>void 0!==e[t.key]&&null!==e[t.key]&&""!==e[t.key])||"image"===t.key?`\n <tr>\n <td class="feature-label">${t.label}</td>\n ${e.map(e=>{const o=e[t.key];return`<td class="product-value">${this.formatFeatureValue(o,t.type,e)}</td>`}).join("")}\n </tr>\n `:"").join("")}\n <tr>\n <td class="feature-label">Acciones</td>\n ${e.map(e=>`\n <td class="product-actions">\n <button class="btn-add-to-cart" onclick="addToCart(${e.id})">\n <i class="fas fa-shopping-cart"></i> Agregar\n </button>\n </td>\n `).join("")}\n </tr>\n </tbody>\n </table>\n </div>\n `}formatFeatureValue(e,t,o){if(null==e||""===e)return'<span class="empty-value">—</span>';switch(t){case"image":return`<img src="${`/images/products/watermarked/${`${o.id}`.toUpperCase()}-watermarked.webp`}" alt="${o.name}" class="comparison-product-image" onerror="this.src='/images/placeholder.svg';">`;case"price":return`<span class="price-value">$${this.formatPrice(e)}</span>`;case"category":return this.getCategoryName(e);case"badge":return e?'<span class="badge badge-success"><i class="fas fa-check"></i> Sí</span>':'<span class="badge badge-secondary"><i class="fas fa-times"></i> No</span>';default:return this.escapeHtml(e.toString())}}getCategoryName(e){return{anniversary:"Aniversario",birthday:"Cumpleaños",graduation:"Graduación",sympathy:"Pésame",romance:"Romance",congratulations:"Felicitaciones",getwell:"Recuperación",thankyou:"Agradecimiento",all:"Todas"}[e]||e}formatPrice(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}saveToStorage(){try{localStorage.setItem(this.config.storageKey,JSON.stringify(this.selectedProducts))}catch(e){console.warn("No se pudo guardar en localStorage:",e)}}loadFromStorage(){try{const e=localStorage.getItem(this.config.storageKey);e&&(this.selectedProducts=JSON.parse(e))}catch(e){console.warn("No se pudo cargar desde localStorage:",e),this.selectedProducts=[]}}showToast(e,t="info"){void 0!==window.Toast&&window.Toast.show(e,t)}isSelected(e){return this.selectedProducts.includes(e)}toggleProduct(e){this.isSelected(e)?this.removeProduct(e):this.addProduct(e)}}}();
//# sourceMappingURL=product-comparison.min.js.map