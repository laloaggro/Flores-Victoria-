const CartManager={STORAGE_KEY:"flores_victoria_cart",MAX_QUANTITY:99,MIN_QUANTITY:1,items:[],init(){this.loadCart(),this.updateCartUI(),this.attachEventListeners()},attachEventListeners(){window.addEventListener("storage",t=>{t.key===this.STORAGE_KEY&&(this.loadCart(),this.updateCartUI())})},loadCart(){try{const t=localStorage.getItem(this.STORAGE_KEY);this.items=t?JSON.parse(t):[],this.items=this.items.filter(this.validateItem.bind(this))}catch(t){console.error("‚ùå Error loading cart:",t),this.items=[],this.showError("Error al cargar el carrito")}},saveCart(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.items)),this.updateCartUI(),this.dispatchCartEvent()}catch(t){console.error("‚ùå Error saving cart:",t),"QuotaExceededError"===t.name?this.showError("Carrito lleno. Por favor, finaliza tu compra."):this.showError("Error al guardar el carrito")}},validateItem:t=>t&&void 0!==t.id&&"string"==typeof t.name&&"number"==typeof t.price&&t.price>0&&"number"==typeof t.quantity&&t.quantity>0,validateProduct(t){return t&&"object"==typeof t?t.id&&t.name&&t.price?!("number"!=typeof t.price||t.price<=0)||(this.showError("Precio inv√°lido"),!1):(this.showError("Faltan datos del producto"),!1):(this.showError("Producto inv√°lido"),!1)},addItem(t){if(!this.validateProduct(t))return!1;const e=this.items.find(e=>e.id===t.id),i=t.quantity||1;if(e){const t=e.quantity+i;if(t>this.MAX_QUANTITY)return this.showError(`Cantidad m√°xima: ${this.MAX_QUANTITY}`),!1;e.quantity=t}else this.items.push({id:t.id,name:t.name,price:t.price,image:t.image||"/img/placeholder.jpg",quantity:Math.min(i,this.MAX_QUANTITY)});return this.saveCart(),this.showSuccess(`${t.name} agregado al carrito`),!0},removeItem(t){const e=this.items.findIndex(e=>e.id===t);if(-1===e)return this.showError("Producto no encontrado en el carrito"),!1;const i=this.items[e];return this.items.splice(e,1),this.saveCart(),this.showInfo(`${i.name} eliminado del carrito`),!0},updateQuantity(t,e){const i=this.items.find(e=>e.id===t);return i?e<=0?this.removeItem(t):e>this.MAX_QUANTITY?(this.showError(`Cantidad m√°xima: ${this.MAX_QUANTITY}`),i.quantity=this.MAX_QUANTITY,this.saveCart(),!1):(i.quantity=Math.max(this.MIN_QUANTITY,Math.floor(e)),this.saveCart(),!0):(this.showError("Producto no encontrado"),!1)},getItems(){return[...this.items]},getItemCount(){return this.items.reduce((t,e)=>t+e.quantity,0)},getTotal(){return this.items.reduce((t,e)=>t+e.price*e.quantity,0)},hasItem(t){return this.items.some(e=>e.id===t)},getItem(t){return this.items.find(e=>e.id===t)},getUniqueItemCount(){return this.items.length},isEmpty(){return 0===this.items.length},clearCart(){this.isEmpty()?this.showInfo("El carrito ya est√° vac√≠o"):(this.items=[],this.saveCart(),this.showInfo("Carrito vaciado"))},updateCartUI(){const t=this.getItemCount(),e=this.getTotal();document.querySelectorAll(".cart-count, .cart-counter").forEach(e=>{e.textContent=t,e.style.display=t>0?"inline-block":"none",e.classList.toggle("has-items",t>0)}),document.querySelectorAll(".cart-total").forEach(t=>{t.textContent=this.formatPrice(e)}),document.querySelectorAll(".cart-empty-message").forEach(e=>{e.style.display=0===t?"block":"none"}),document.querySelectorAll(".cart-items-container").forEach(e=>{e.style.display=t>0?"block":"none"})},dispatchCartEvent(){const t=new CustomEvent("cartUpdated",{detail:{items:this.getItems(),count:this.getItemCount(),uniqueCount:this.getUniqueItemCount(),total:this.getTotal(),isEmpty:this.isEmpty()},bubbles:!0});window.dispatchEvent(t)},renderCartItems(t){const e=document.getElementById(t);if(!e)return void console.warn(`‚ö†Ô∏è Cart container #${t} not found`);if(this.isEmpty())return void(e.innerHTML='\n <div class="cart-empty">\n <div class="empty-cart-icon">üõí</div>\n <p class="empty-cart-message">Tu carrito est√° vac√≠o</p>\n <a href="/pages/products.html" class="btn btn-primary">Ver productos</a>\n </div>\n ');const i=this.items.map(t=>`\n <div class="cart-item" data-id="${t.id}">\n <img src="${t.image}" \n alt="${t.name}" \n class="cart-item-image"\n loading="lazy">\n <div class="cart-item-details">\n <h3 class="cart-item-name">${t.name}</h3>\n <p class="cart-item-price">${this.formatPrice(t.price)}</p>\n </div>\n <div class="cart-item-quantity">\n <button class="qty-btn qty-decrease" \n onclick="CartManager.updateQuantity('${t.id}', ${t.quantity-1})"\n aria-label="Disminuir cantidad">\n <i class="fas fa-minus"></i>\n </button>\n <input type="number" \n value="${t.quantity}" \n min="${this.MIN_QUANTITY}" \n max="${this.MAX_QUANTITY}"\n class="qty-input"\n aria-label="Cantidad"\n onchange="CartManager.updateQuantity('${t.id}', parseInt(this.value))">\n <button class="qty-btn qty-increase" \n onclick="CartManager.updateQuantity('${t.id}', ${t.quantity+1})"\n aria-label="Aumentar cantidad">\n <i class="fas fa-plus"></i>\n </button>\n </div>\n <div class="cart-item-total">\n <span class="item-total-label">Subtotal:</span>\n <span class="item-total-amount">${this.formatPrice(t.price*t.quantity)}</span>\n </div>\n <button class="cart-item-remove" \n onclick="CartManager.removeItem('${t.id}')"\n aria-label="Eliminar ${t.name}">\n <i class="fas fa-trash" aria-hidden="true"></i>\n </button>\n </div>\n `).join("");e.innerHTML=i},formatPrice:t=>"undefined"!=typeof FloresVictoriaUtils&&FloresVictoriaUtils.formatPrice?FloresVictoriaUtils.formatPrice(t):`$${t.toLocaleString("es-CL")}`,showSuccess(t){"undefined"!=typeof ToastComponent&&ToastComponent.success&&ToastComponent.success(t)},showInfo(t){"undefined"!=typeof ToastComponent&&ToastComponent.info&&ToastComponent.info(t)},showError(t){"undefined"!=typeof ToastComponent&&ToastComponent.error?ToastComponent.error(t):console.error("‚ùå",t)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>CartManager.init()):CartManager.init(),"undefined"!=typeof module&&module.exports&&(module.exports=CartManager),"undefined"!=typeof window&&(window.CartManager=CartManager);
//# sourceMappingURL=cart-manager.min.js.map