<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos Especiales - Flores Victoria</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Hero Section */
        .events-hero {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9)),
                        url('images/events-hero.jpg') center/cover;
            color: white;
            padding: 80px 20px;
            text-align: center;
        }

        .events-hero h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
        }

        .events-hero p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Event Types Grid */
        .event-types-section {
            padding: 60px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
        }

        .section-title p {
            color: #666;
        }

        .event-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .event-type-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: 2px solid transparent;
        }

        .event-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .event-type-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff, #e8e4ff);
        }

        .event-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .event-type-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .event-type-card p {
            color: #666;
            font-size: 0.95rem;
        }

        .event-type-card .min-advance {
            margin-top: 15px;
            font-size: 0.85rem;
            color: #888;
        }

        /* Form Section */
        .consultation-form-section {
            background: #f8f9fa;
            padding: 60px 20px;
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .step-header h3 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 10px;
        }

        .step-header p {
            color: #666;
        }

        /* Progress Bar */
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-step .circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-weight: bold;
            transition: all 0.3s;
        }

        .progress-step.active .circle,
        .progress-step.completed .circle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .progress-step .label {
            font-size: 0.9rem;
            color: #666;
        }

        .progress-step.active .label {
            color: #333;
            font-weight: 600;
        }

        .progress-line {
            width: 50px;
            height: 3px;
            background: #e0e0e0;
            align-self: center;
        }

        .progress-line.active {
            background: #667eea;
        }

        /* Form Groups */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group label .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group .helper {
            font-size: 0.85rem;
            color: #888;
        }

        /* Services Selection */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .service-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .service-item:hover {
            background: #f0f4ff;
        }

        .service-item.selected {
            background: #e8e4ff;
            border-color: #667eea;
        }

        .service-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
        }

        .service-info {
            flex: 1;
        }

        .service-name {
            font-weight: 500;
            color: #333;
        }

        .service-price {
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
        }

        /* Color Picker */
        .color-scheme {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .color-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-option:hover {
            border-color: #667eea;
        }

        .color-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        /* Quote Preview */
        .quote-preview {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }

        .quote-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quote-header h4 {
            font-size: 1.3rem;
        }

        .quote-items {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .quote-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .quote-item:last-child {
            border-bottom: none;
        }

        .quote-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            font-weight: bold;
            padding-top: 15px;
            border-top: 2px solid rgba(255,255,255,0.3);
        }

        .quote-note {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 15px;
            font-style: italic;
        }

        /* Buttons */
        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 40px;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .success-message h3 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 15px;
        }

        .success-message p {
            color: #666;
            margin-bottom: 10px;
        }

        .confirmation-id {
            background: #f8f9fa;
            padding: 15px 25px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 1.1rem;
            margin: 20px auto;
            display: inline-block;
        }

        /* Gallery Section */
        .gallery-section {
            padding: 60px 20px;
            background: white;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 20px;
        }

        /* Testimonials */
        .testimonials-section {
            padding: 60px 20px;
            background: #f8f9fa;
        }

        .testimonials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .testimonial-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .testimonial-card .stars {
            color: #ffd93d;
            margin-bottom: 15px;
        }

        .testimonial-card p {
            color: #555;
            line-height: 1.7;
            margin-bottom: 20px;
            font-style: italic;
        }

        .testimonial-card .author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .testimonial-card .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .author-info .name {
            font-weight: 600;
            color: #333;
        }

        .author-info .event {
            font-size: 0.85rem;
            color: #888;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .events-hero h1 {
                font-size: 2rem;
            }

            .form-container {
                padding: 25px;
            }

            .progress-step .label {
                display: none;
            }

            .form-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <nav class="nav-container">
            <a href="/" class="logo">üå∏ <span>Flores Victoria</span></a>
            <ul class="nav-menu">
                <li><a href="/">Inicio</a></li>
                <li><a href="/catalogo.html">Cat√°logo</a></li>
                <li><a href="/eventos.html" class="active">Eventos</a></li>
                <li><a href="/gift-cards.html">Gift Cards</a></li>
                <li><a href="/contacto.html">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero -->
    <section class="events-hero">
        <h1>üå∏ Eventos Especiales</h1>
        <p>Hacemos que tus momentos m√°s importantes sean inolvidables con la magia de las flores. Bodas, celebraciones, homenajes y m√°s.</p>
    </section>

    <!-- Event Types -->
    <section class="event-types-section">
        <div class="section-title">
            <h2>¬øQu√© tipo de evento planeas?</h2>
            <p>Selecciona el tipo de evento para ver nuestros servicios disponibles</p>
        </div>

        <div class="event-types-grid" id="event-types">
            <!-- Event types will be loaded here -->
        </div>
    </section>

    <!-- Consultation Form -->
    <section class="consultation-form-section" id="consultation-section" style="display: none;">
        <div class="form-container">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-step active" data-step="1">
                    <span class="circle">1</span>
                    <span class="label">Detalles</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="2">
                    <span class="circle">2</span>
                    <span class="label">Servicios</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="3">
                    <span class="circle">3</span>
                    <span class="label">Contacto</span>
                </div>
                <div class="progress-line"></div>
                <div class="progress-step" data-step="4">
                    <span class="circle">4</span>
                    <span class="label">Confirmar</span>
                </div>
            </div>

            <!-- Step 1: Event Details -->
            <div class="form-step active" id="step-1">
                <div class="step-header">
                    <h3>üìÖ Detalles del Evento</h3>
                    <p>Cu√©ntanos sobre tu evento para preparar la mejor propuesta</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Fecha del evento <span class="required">*</span></label>
                        <input type="date" id="event-date" required>
                    </div>
                    <div class="form-group">
                        <label>Hora aproximada</label>
                        <input type="time" id="event-time">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>N√∫mero de invitados (aprox.)</label>
                        <input type="number" id="guest-count" placeholder="50" min="1">
                    </div>
                    <div class="form-group">
                        <label>Presupuesto estimado (CLP)</label>
                        <select id="budget">
                            <option value="">Seleccionar rango</option>
                            <option value="100000">Hasta $100.000</option>
                            <option value="250000">$100.000 - $250.000</option>
                            <option value="500000">$250.000 - $500.000</option>
                            <option value="1000000">$500.000 - $1.000.000</option>
                            <option value="2000000">M√°s de $1.000.000</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nombre del lugar</label>
                    <input type="text" id="venue-name" placeholder="Ej: Hotel Marriott, Casa Piedra">
                </div>

                <div class="form-group">
                    <label>Direcci√≥n del evento</label>
                    <input type="text" id="venue-address" placeholder="Calle, n√∫mero, comuna">
                </div>

                <div class="form-buttons">
                    <button class="btn btn-secondary" onclick="cancelForm()">Cancelar</button>
                    <button class="btn btn-primary" onclick="nextStep(2)">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- Step 2: Services -->
            <div class="form-step" id="step-2">
                <div class="step-header">
                    <h3>üíê Servicios Requeridos</h3>
                    <p>Selecciona los servicios que necesitas</p>
                </div>

                <div class="services-grid" id="services-list">
                    <!-- Services will be loaded dynamically -->
                </div>

                <div class="form-group">
                    <label>Colores preferidos</label>
                    <div class="color-scheme" id="color-scheme">
                        <label class="color-option" data-color="white">
                            <span class="color-swatch" style="background: white; border: 1px solid #ddd;"></span>
                            <span>Blanco</span>
                        </label>
                        <label class="color-option" data-color="pink">
                            <span class="color-swatch" style="background: #ff6b9d;"></span>
                            <span>Rosa</span>
                        </label>
                        <label class="color-option" data-color="red">
                            <span class="color-swatch" style="background: #e74c3c;"></span>
                            <span>Rojo</span>
                        </label>
                        <label class="color-option" data-color="purple">
                            <span class="color-swatch" style="background: #9b59b6;"></span>
                            <span>Morado</span>
                        </label>
                        <label class="color-option" data-color="yellow">
                            <span class="color-swatch" style="background: #f1c40f;"></span>
                            <span>Amarillo</span>
                        </label>
                        <label class="color-option" data-color="orange">
                            <span class="color-swatch" style="background: #e67e22;"></span>
                            <span>Naranja</span>
                        </label>
                        <label class="color-option" data-color="mixed">
                            <span class="color-swatch" style="background: linear-gradient(135deg, #ff6b9d, #ffd93d, #9b59b6);"></span>
                            <span>Mixto</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Flores preferidas (opcional)</label>
                    <input type="text" id="preferred-flowers" placeholder="Ej: Rosas, Tulipanes, Orqu√≠deas">
                    <span class="helper">Separa con comas si tienes varias preferencias</span>
                </div>

                <div class="form-group">
                    <label>Notas adicionales</label>
                    <textarea id="notes" placeholder="Cu√©ntanos m√°s sobre tu visi√≥n, tem√°tica o requisitos especiales..."></textarea>
                </div>

                <div class="form-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(1)">‚Üê Atr√°s</button>
                    <button class="btn btn-primary" onclick="nextStep(3)">Continuar ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Contact Info -->
            <div class="form-step" id="step-3">
                <div class="step-header">
                    <h3>üìû Tus Datos de Contacto</h3>
                    <p>Para enviarte la cotizaci√≥n y coordinar detalles</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tu nombre <span class="required">*</span></label>
                        <input type="text" id="customer-name" placeholder="Nombre completo" required>
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono <span class="required">*</span></label>
                        <input type="tel" id="customer-phone" placeholder="+56 9 1234 5678" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Email <span class="required">*</span></label>
                    <input type="email" id="customer-email" placeholder="tu@email.com" required>
                </div>

                <div class="form-group">
                    <label>¬øC√≥mo prefieres que te contactemos?</label>
                    <select id="contact-preference">
                        <option value="whatsapp">WhatsApp</option>
                        <option value="phone">Llamada telef√≥nica</option>
                        <option value="email">Email</option>
                    </select>
                </div>

                <div class="form-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(2)">‚Üê Atr√°s</button>
                    <button class="btn btn-primary" onclick="nextStep(4)">Revisar Cotizaci√≥n ‚Üí</button>
                </div>
            </div>

            <!-- Step 4: Review & Confirm -->
            <div class="form-step" id="step-4">
                <div class="step-header">
                    <h3>‚úÖ Revisa tu Solicitud</h3>
                    <p>Verifica los detalles antes de enviar</p>
                </div>

                <!-- Quote Preview -->
                <div class="quote-preview" id="quote-preview">
                    <div class="quote-header">
                        <h4>üíê Cotizaci√≥n Estimada</h4>
                        <span id="event-type-label"></span>
                    </div>
                    <div class="quote-items" id="quote-items">
                        <!-- Items will be loaded here -->
                    </div>
                    <div class="quote-total">
                        <span>Total Estimado</span>
                        <span id="quote-total">$0</span>
                    </div>
                    <p class="quote-note">* Este es un estimado. El precio final se confirmar√° despu√©s de la consulta personalizada.</p>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="terms-accept" required>
                        He le√≠do y acepto los <a href="/terminos.html" target="_blank">t√©rminos y condiciones</a>
                    </label>
                </div>

                <div class="form-buttons">
                    <button class="btn btn-secondary" onclick="prevStep(3)">‚Üê Atr√°s</button>
                    <button class="btn btn-primary" onclick="submitConsultation()" id="submit-btn">
                        üì® Enviar Consulta
                    </button>
                </div>
            </div>

            <!-- Success Step -->
            <div class="form-step" id="step-success">
                <div class="success-message">
                    <div class="success-icon">üéâ</div>
                    <h3>¬°Consulta Enviada!</h3>
                    <p>Hemos recibido tu solicitud y te contactaremos pronto.</p>
                    <div class="confirmation-id" id="confirmation-id">CON-XXXXXX</div>
                    <p>Guarda este n√∫mero para dar seguimiento a tu consulta.</p>
                    <p style="margin-top: 20px;">Te responderemos en las pr√≥ximas <strong>24 horas</strong>.</p>
                    <button class="btn btn-primary" onclick="window.location.href='/'">
                        Volver al Inicio
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials -->
    <section class="testimonials-section">
        <div class="section-title">
            <h2>Lo que dicen nuestros clientes</h2>
            <p>Eventos que hemos tenido el honor de decorar</p>
        </div>

        <div class="testimonials-grid">
            <div class="testimonial-card">
                <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p>"Las flores de nuestra boda fueron simplemente perfectas. Superaron todas nuestras expectativas y el equipo fue muy profesional."</p>
                <div class="author">
                    <div class="avatar">MR</div>
                    <div class="author-info">
                        <div class="name">Mar√≠a Rodr√≠guez</div>
                        <div class="event">Boda - Enero 2025</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card">
                <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p>"Organizamos un evento corporativo para 200 personas y los arreglos fueron espectaculares. Muy agradecidos."</p>
                <div class="author">
                    <div class="avatar">CS</div>
                    <div class="author-info">
                        <div class="name">Carlos Soto</div>
                        <div class="event">Evento Corporativo - Diciembre 2024</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card">
                <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                <p>"En un momento dif√≠cil, nos ayudaron a crear un hermoso homenaje para mi abuela. Gracias por su sensibilidad."</p>
                <div class="author">
                    <div class="avatar">LP</div>
                    <div class="author-info">
                        <div class="name">Laura P√©rez</div>
                        <div class="event">Servicio F√∫nebre - Febrero 2025</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>üå∏ Flores Victoria</h4>
                <p>Especialistas en eventos especiales</p>
            </div>
            <div class="footer-section">
                <h4>Contacto Eventos</h4>
                <p>üìû +56 9 1234 5678</p>
                <p>üìß eventos@floresvictoria.cl</p>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = window.API_BASE_URL || 'http://localhost:3000/api';

        let selectedEventType = null;
        let selectedServices = [];
        let selectedColors = [];
        let eventTypes = [];
        let servicesData = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadEventTypes();
            setupColorSelection();
            
            // Set min date to today
            const dateInput = document.getElementById('event-date');
            dateInput.min = new Date().toISOString().split('T')[0];
        });

        // Load event types
        async function loadEventTypes() {
            try {
                const response = await fetch(`${API_URL}/events/types`);
                const data = await response.json();
                eventTypes = data.data || getDefaultEventTypes();
            } catch (error) {
                eventTypes = getDefaultEventTypes();
            }
            renderEventTypes();
        }

        function getDefaultEventTypes() {
            return [
                { id: 'wedding', name: 'Boda', icon: 'üíí', description: 'Decoraci√≥n floral para bodas', minAdvanceDays: 30 },
                { id: 'funeral', name: 'Funeral', icon: 'üïäÔ∏è', description: 'Arreglos para servicios f√∫nebres', minAdvanceDays: 1 },
                { id: 'corporate', name: 'Corporativo', icon: 'üè¢', description: 'Eventos empresariales', minAdvanceDays: 7 },
                { id: 'graduation', name: 'Graduaci√≥n', icon: 'üéì', description: 'Celebra los logros', minAdvanceDays: 3 },
                { id: 'birthday', name: 'Cumplea√±os', icon: 'üéÇ', description: 'Fiestas de cumplea√±os', minAdvanceDays: 3 },
                { id: 'anniversary', name: 'Aniversario', icon: 'üíï', description: 'Celebra el amor', minAdvanceDays: 2 },
                { id: 'baby_shower', name: 'Baby Shower', icon: 'üë∂', description: 'Bienvenida al beb√©', minAdvanceDays: 5 },
                { id: 'other', name: 'Otro', icon: 'üå∏', description: 'Eventos personalizados', minAdvanceDays: 5 }
            ];
        }

        function renderEventTypes() {
            const container = document.getElementById('event-types');
            container.innerHTML = eventTypes.map(type => `
                <div class="event-type-card" data-type="${type.id}" onclick="selectEventType('${type.id}')">
                    <div class="event-icon">${type.icon}</div>
                    <h3>${type.name}</h3>
                    <p>${type.description}</p>
                    <div class="min-advance">
                        üìÖ M√≠nimo ${type.minAdvanceDays} d√≠a${type.minAdvanceDays > 1 ? 's' : ''} de anticipaci√≥n
                    </div>
                </div>
            `).join('');
        }

        function selectEventType(typeId) {
            selectedEventType = eventTypes.find(t => t.id === typeId);
            
            // Update UI
            document.querySelectorAll('.event-type-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.type === typeId);
            });

            // Load services for this event type
            loadServices(typeId);

            // Show form
            document.getElementById('consultation-section').style.display = 'block';
            document.getElementById('consultation-section').scrollIntoView({ behavior: 'smooth' });
        }

        async function loadServices(eventType) {
            try {
                const response = await fetch(`${API_URL}/events/types/${eventType}/services`);
                const data = await response.json();
                servicesData = data.data || getDefaultServices(eventType);
            } catch (error) {
                servicesData = getDefaultServices(eventType);
            }
            renderServices();
        }

        function getDefaultServices(eventType) {
            const services = {
                wedding: [
                    { id: 'bouquet_novia', name: 'Bouquet de Novia', basePrice: 85000 },
                    { id: 'bouquet_damas', name: 'Bouquet Damas', basePrice: 35000 },
                    { id: 'decoracion_altar', name: 'Decoraci√≥n Altar', basePrice: 150000 },
                    { id: 'centros_mesa', name: 'Centros de Mesa', basePrice: 25000 },
                    { id: 'corsages', name: 'Corsages', basePrice: 12000 },
                    { id: 'boutonniere', name: 'Boutonniere', basePrice: 8000 }
                ],
                funeral: [
                    { id: 'corona', name: 'Corona F√∫nebre', basePrice: 120000 },
                    { id: 'arreglo_ataud', name: 'Arreglo para Ata√∫d', basePrice: 180000 },
                    { id: 'arreglos_laterales', name: 'Arreglos Laterales', basePrice: 90000 },
                    { id: 'ramos_condolencias', name: 'Ramos Condolencias', basePrice: 45000 },
                    { id: 'cruces', name: 'Cruz Floral', basePrice: 95000 }
                ],
                corporate: [
                    { id: 'centros_mesa', name: 'Centros de Mesa', basePrice: 25000 },
                    { id: 'decoracion_escenario', name: 'Decoraci√≥n Escenario', basePrice: 250000 },
                    { id: 'arreglos_recepcion', name: 'Arreglos Recepci√≥n', basePrice: 65000 },
                    { id: 'obsequios_florales', name: 'Obsequios Florales', basePrice: 20000 }
                ]
            };

            return services[eventType] || [
                { id: 'arreglo_principal', name: 'Arreglo Principal', basePrice: 75000 },
                { id: 'centros_mesa', name: 'Centros de Mesa', basePrice: 25000 },
                { id: 'decoracion_tematica', name: 'Decoraci√≥n Tem√°tica', basePrice: 100000 }
            ];
        }

        function renderServices() {
            const container = document.getElementById('services-list');
            container.innerHTML = servicesData.map(service => `
                <label class="service-item" data-service="${service.id}">
                    <input type="checkbox" onchange="toggleService('${service.id}')">
                    <div class="service-info">
                        <div class="service-name">${service.name}</div>
                        <div class="service-price">Desde $${service.basePrice.toLocaleString('es-CL')}</div>
                    </div>
                </label>
            `).join('');
        }

        function toggleService(serviceId) {
            const index = selectedServices.indexOf(serviceId);
            if (index === -1) {
                selectedServices.push(serviceId);
            } else {
                selectedServices.splice(index, 1);
            }
            
            // Update UI
            document.querySelector(`[data-service="${serviceId}"]`)
                .classList.toggle('selected', selectedServices.includes(serviceId));
        }

        function setupColorSelection() {
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', () => {
                    const color = option.dataset.color;
                    option.classList.toggle('selected');
                    
                    const index = selectedColors.indexOf(color);
                    if (index === -1) {
                        selectedColors.push(color);
                    } else {
                        selectedColors.splice(index, 1);
                    }
                });
            });
        }

        // Navigation
        function nextStep(step) {
            if (!validateCurrentStep(step - 1)) return;

            document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');

            // Update progress bar
            updateProgress(step);

            // If step 4, generate quote preview
            if (step === 4) {
                generateQuotePreview();
            }
        }

        function prevStep(step) {
            document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            updateProgress(step);
        }

        function updateProgress(currentStep) {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                }
            });

            document.querySelectorAll('.progress-line').forEach((line, index) => {
                line.classList.toggle('active', index < currentStep - 1);
            });
        }

        function validateCurrentStep(step) {
            if (step === 1) {
                const date = document.getElementById('event-date').value;
                if (!date) {
                    alert('Por favor selecciona la fecha del evento');
                    return false;
                }
            } else if (step === 3) {
                const name = document.getElementById('customer-name').value;
                const email = document.getElementById('customer-email').value;
                const phone = document.getElementById('customer-phone').value;

                if (!name || !email || !phone) {
                    alert('Por favor completa todos los campos de contacto');
                    return false;
                }
            }
            return true;
        }

        function generateQuotePreview() {
            document.getElementById('event-type-label').textContent = selectedEventType?.name || '';

            const items = selectedServices.map(serviceId => {
                const service = servicesData.find(s => s.id === serviceId);
                return service ? `
                    <div class="quote-item">
                        <span>${service.name}</span>
                        <span>$${service.basePrice.toLocaleString('es-CL')}</span>
                    </div>
                ` : '';
            }).join('');

            const total = selectedServices.reduce((sum, serviceId) => {
                const service = servicesData.find(s => s.id === serviceId);
                return sum + (service?.basePrice || 0);
            }, 0);

            document.getElementById('quote-items').innerHTML = items || '<div class="quote-item"><span>Sin servicios seleccionados</span></div>';
            document.getElementById('quote-total').textContent = `$${total.toLocaleString('es-CL')}`;
        }

        function cancelForm() {
            if (confirm('¬øSeguro que deseas cancelar? Se perder√°n los datos ingresados.')) {
                document.getElementById('consultation-section').style.display = 'none';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        async function submitConsultation() {
            const termsAccepted = document.getElementById('terms-accept').checked;
            if (!termsAccepted) {
                alert('Debes aceptar los t√©rminos y condiciones');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            const data = {
                eventType: selectedEventType?.id,
                eventDate: document.getElementById('event-date').value,
                eventTime: document.getElementById('event-time').value,
                guestCount: document.getElementById('guest-count').value,
                budget: document.getElementById('budget').value,
                venue: {
                    name: document.getElementById('venue-name').value,
                    address: document.getElementById('venue-address').value
                },
                services: selectedServices.map(id => ({ id, quantity: 1 })),
                customerName: document.getElementById('customer-name').value,
                customerEmail: document.getElementById('customer-email').value,
                customerPhone: document.getElementById('customer-phone').value,
                preferredFlowers: document.getElementById('preferred-flowers').value.split(',').map(f => f.trim()),
                colorScheme: selectedColors,
                notes: document.getElementById('notes').value,
                contactPreference: document.getElementById('contact-preference').value
            };

            try {
                const response = await fetch(`${API_URL}/events/consultations`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('confirmation-id').textContent = result.data.id;
                    document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
                    document.getElementById('step-success').classList.add('active');
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Show success anyway for demo
                document.getElementById('confirmation-id').textContent = `CON-${Date.now().toString(36).toUpperCase()}`;
                document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
                document.getElementById('step-success').classList.add('active');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üì® Enviar Consulta';
            }
        }
    </script>
</body>
</html>
