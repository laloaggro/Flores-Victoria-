<!-- 
  ========================================
  TEMPLATE: Google Analytics 4 + Web Vitals
  ========================================
  
  INSTRUCCIONES:
  1. Obt√©n tu Measurement ID de GA4 (formato: G-XXXXXXXXXX)
  2. Reemplaza "G-XXXXXXXXXX" en ambos lugares marcados con üî¥
  3. Copia todo el c√≥digo DENTRO de <head> de tu index.html
  4. Aseg√∫rate de agregar <script src="/web-vitals.js" defer></script> antes de </body>
  
  IMPORTANTE: Este archivo es solo un template de referencia.
  NO lo uses directamente en producci√≥n.
-->

<!-- Google Analytics 4 - Cargar ANTES que otros scripts -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<!-- üî¥ REEMPLAZA G-XXXXXXXXXX con tu Measurement ID real -->

<script>
  // Inicializar dataLayer
  window.dataLayer = window.dataLayer || [];
  
  function gtag() {
    dataLayer.push(arguments);
  }
  
  // Configurar fecha inicial
  gtag('js', new Date());
  
  // Configurar Google Analytics 4
  gtag('config', 'G-XXXXXXXXXX', {
    // üî¥ REEMPLAZA G-XXXXXXXXXX con tu Measurement ID real
    
    // Enviar page view autom√°ticamente
    'send_page_view': true,
    
    // Anonimizar IP (GDPR compliance)
    'anonymize_ip': true,
    
    // Configuraci√≥n de cookies
    'cookie_flags': 'SameSite=None;Secure',
    'cookie_domain': 'auto',
    'cookie_expires': 63072000, // 2 a√±os en segundos
    
    // Custom parameters (opcional)
    'custom_map': {
      'dimension1': 'user_type',
      'dimension2': 'page_category'
    }
  });
  
  // Evento inicial de app_initialized (opcional)
  gtag('event', 'app_initialized', {
    'event_category': 'App Lifecycle',
    'event_label': 'First Load',
    'app_version': '3.0.1',
    'non_interaction': true
  });
  
  // Helper: Track Custom Events
  window.trackEvent = function(eventName, params) {
    if (typeof gtag === 'function') {
      gtag('event', eventName, params || {});
      console.log('üìä Event tracked:', eventName, params);
    } else {
      console.warn('gtag not loaded yet');
    }
  };
  
  // Helper: Track Page View (para SPA navigation)
  window.trackPageView = function(pagePath) {
    if (typeof gtag === 'function') {
      gtag('event', 'page_view', {
        page_path: pagePath,
        page_title: document.title
      });
      console.log('üìÑ Page view tracked:', pagePath);
    }
  };
</script>

<!-- 
  ========================================
  EVENTOS PERSONALIZADOS DE EJEMPLO
  ========================================
  
  Agrega estos eventos en tu c√≥digo JavaScript donde corresponda:
-->

<script>
  // EJEMPLO 1: Tracking de clicks en productos
  function trackProductClick(productId, productName, productPrice) {
    gtag('event', 'select_item', {
      'event_category': 'Products',
      'items': [{
        'item_id': productId,
        'item_name': productName,
        'price': productPrice,
        'currency': 'CLP'
      }]
    });
  }
  
  // EJEMPLO 2: Tracking de agregar al carrito
  function trackAddToCart(productId, productName, productPrice, quantity) {
    gtag('event', 'add_to_cart', {
      'event_category': 'E-commerce',
      'currency': 'CLP',
      'value': productPrice * quantity,
      'items': [{
        'item_id': productId,
        'item_name': productName,
        'price': productPrice,
        'quantity': quantity
      }]
    });
  }
  
  // EJEMPLO 3: Tracking de compra completada
  function trackPurchase(orderId, total, items) {
    gtag('event', 'purchase', {
      'transaction_id': orderId,
      'value': total,
      'currency': 'CLP',
      'shipping': 5000, // Costo de env√≠o
      'tax': 0, // IVA si aplica
      'items': items // Array de productos
    });
  }
  
  // EJEMPLO 4: Tracking de formulario de contacto
  function trackContactFormSubmit(formName) {
    gtag('event', 'generate_lead', {
      'event_category': 'Contact',
      'event_label': formName,
      'value': 1
    });
  }
  
  // EJEMPLO 5: Tracking de b√∫squeda
  function trackSearch(searchTerm, resultsCount) {
    gtag('event', 'search', {
      'search_term': searchTerm,
      'event_category': 'Site Search',
      'value': resultsCount
    });
  }
  
  // EJEMPLO 6: Tracking de scroll depth
  let scrollTracked = false;
  window.addEventListener('scroll', function() {
    const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
    
    if (scrollPercent > 75 && !scrollTracked) {
      gtag('event', 'scroll_depth', {
        'event_category': 'Engagement',
        'event_label': '75%',
        'value': 75
      });
      scrollTracked = true;
    }
  });
</script>

<!-- 
  ========================================
  CONFIGURACI√ìN DE CONSENT MODE (GDPR)
  ========================================
  
  Si necesitas cumplir con GDPR/CCPA, agrega esto ANTES del script de gtag.js:
-->

<script>
  // Default consent state (denegar hasta que usuario acepte)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'functionality_storage': 'denied',
    'personalization_storage': 'denied',
    'security_storage': 'granted', // Siempre permitido
    'wait_for_update': 500
  });
  
  // Cuando usuario acepta cookies:
  function acceptCookies() {
    gtag('consent', 'update', {
      'ad_storage': 'granted',
      'analytics_storage': 'granted',
      'functionality_storage': 'granted',
      'personalization_storage': 'granted'
    });
    
    console.log('‚úÖ Cookies aceptadas');
  }
  
  // Llamar acceptCookies() cuando usuario haga clic en "Aceptar Cookies"
</script>

<!-- 
  ========================================
  VERIFICACI√ìN DE INSTALACI√ìN
  ========================================
  
  Para verificar que GA4 est√° funcionando:
  
  1. Abre Chrome DevTools (F12)
  2. Ve a la pesta√±a "Network"
  3. Filtra por "google-analytics.com/g/collect"
  4. Navega por tu sitio
  5. Deber√≠as ver requests a GA4
  
  O instala la extensi√≥n:
  - Google Analytics Debugger: https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna
  
  Tambi√©n verifica en:
  - GA4 ‚Üí Admin ‚Üí DebugView (requiere modo debug)
  - GA4 ‚Üí Reports ‚Üí Realtime (datos en tiempo real)
-->

<!-- 
  ========================================
  MODO DEBUG (DESARROLLO)
  ========================================
  
  Para activar debug mode durante desarrollo:
-->

<script>
  // Solo en desarrollo (detectar localhost)
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    window['ga-disable-G-XXXXXXXXXX'] = true; // üî¥ REEMPLAZA con tu ID
    console.log('‚ö†Ô∏è Google Analytics DESHABILITADO en localhost');
    
    // Mockear gtag para desarrollo
    window.gtag = function() {
      console.log('üß™ [MOCK] gtag called:', arguments);
    };
  }
</script>
