<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ Pedidos - Flores Victoria Enterprise</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì¶</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-50: #eff6ff; --primary-100: #dbeafe; --primary-200: #bfdbfe; --primary-300: #93c5fd; --primary-400: #60a5fa; --primary-500: #3b82f6; --primary-600: #2563eb; --primary-700: #1d4ed8; --primary-800: #1e40af; --primary-900: #1e3a8a; --primary: var(--primary-600);
            --secondary-50: #ecfdf5; --secondary-100: #d1fae5; --secondary-200: #a7f3d0; --secondary-300: #6ee7b7; --secondary-400: #34d399; --secondary-500: #10b981; --secondary-600: #059669; --secondary-700: #047857; --secondary-800: #065f46; --secondary-900: #064e3b; --secondary: var(--secondary-600);
            --accent-50: #fffbeb; --accent-100: #fef3c7; --accent-200: #fde68a; --accent-300: #fcd34d; --accent-400: #fbbf24; --accent-500: #f59e0b; --accent-600: #d97706; --accent-700: #b45309; --accent-800: #92400e; --accent-900: #78350f; --accent: var(--accent-600);
            --success: var(--secondary-600); --warning: var(--accent-500); --error: #dc2626; --info: var(--primary-500);
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0; --slate-300: #cbd5e1; --slate-400: #94a3b8; --slate-500: #64748b; --slate-600: #475569; --slate-700: #334155; --slate-800: #1e293b; --slate-900: #0f172a;
            --gradient-primary: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%); --gradient-hero: linear-gradient(135deg, #1e293b 0%, #334155 25%, #475569 50%, #64748b 100%); --gradient-mesh: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.15) 0%, transparent 50%), radial-gradient(circle at 40% 80%, rgba(217, 119, 6, 0.15) 0%, transparent 50%);
            --surface-base: #ffffff; --bg-body: var(--slate-50); --bg-sidebar: var(--surface-base);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1); --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1); --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1); --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1); --shadow-colored: 0 20px 40px -12px rgba(37, 99, 235, 0.25);
            --transition-base: all 200ms cubic-bezier(0.4, 0, 0.2, 1); --transition-smooth: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --space-1: 0.25rem; --space-2: 0.5rem; --space-3: 0.75rem; --space-4: 1rem; --space-5: 1.25rem; --space-6: 1.5rem; --space-8: 2rem; --space-10: 2.5rem; --space-12: 3rem;
            --radius-md: 0.375rem; --radius-lg: 0.5rem; --radius-xl: 0.75rem; --radius-2xl: 1rem; --radius-full: 9999px;
            --font-sans: 'Inter', -apple-system, sans-serif; --font-mono: 'JetBrains Mono', monospace;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; line-height: 1.5; scroll-behavior: smooth; }
        body { font-family: var(--font-sans); color: var(--slate-700); background: var(--bg-body); min-height: 100vh; }
        .app-container { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: var(--bg-sidebar); border-right: 1px solid var(--slate-200); position: fixed; height: 100vh; left: 0; top: 0; overflow-y: auto; box-shadow: var(--shadow-lg); z-index: 100; }
        .sidebar-header { padding: var(--space-6); border-bottom: 1px solid var(--slate-200); background: var(--gradient-hero); position: relative; overflow: hidden; }
        .sidebar-header::before { content: ''; position: absolute; inset: 0; background: var(--gradient-mesh); opacity: 0.6; }
        .logo-container { position: relative; z-index: 2; text-align: center; }
        .logo { font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, #fff 0%, #e2e8f0 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: var(--space-2); }
        .logo-subtitle { font-size: 0.8rem; color: var(--slate-300); font-weight: 500; text-transform: uppercase; letter-spacing: 0.1em; }
        .sidebar-nav { padding: var(--space-6) var(--space-4); }
        .nav-section { margin-bottom: var(--space-6); }
        .nav-section-title { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--slate-500); margin-bottom: var(--space-3); padding-left: var(--space-3); }
        .nav-list { list-style: none; }
        .nav-item { margin-bottom: var(--space-1); }
        .nav-link { display: flex; align-items: center; padding: var(--space-3) var(--space-4); color: var(--slate-600); text-decoration: none; border-radius: var(--radius-xl); font-weight: 500; font-size: 0.875rem; transition: var(--transition-base); }
        .nav-link:hover { color: var(--primary-600); background: var(--primary-50); transform: translateX(4px); }
        .nav-link.active { color: white; background: var(--gradient-primary); box-shadow: var(--shadow-colored); }
        .nav-icon { width: 20px; margin-right: var(--space-3); font-size: 1.1rem; }
        
        /* Main Content */
        .main-content { flex: 1; margin-left: 280px; min-height: 100vh; }
        .page-header { background: var(--gradient-hero); position: relative; overflow: hidden; padding: var(--space-10) var(--space-8); }
        .page-header::before { content: ''; position: absolute; inset: 0; background: var(--gradient-mesh); opacity: 0.7; }
        .page-header-content { position: relative; z-index: 2; max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--space-4); }
        .page-title { font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #fff 0%, #e2e8f0 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: var(--space-2); }
        .page-subtitle { font-size: 1rem; color: var(--slate-300); }
        .content-section { padding: var(--space-8); max-width: 1600px; margin: 0 auto; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-6); }
        .stat-card { background: var(--surface-base); border-radius: var(--radius-2xl); padding: var(--space-5); box-shadow: var(--shadow-md); border: 1px solid var(--slate-200); display: flex; align-items: center; gap: var(--space-4); }
        .stat-icon { width: 48px; height: 48px; border-radius: var(--radius-xl); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .stat-icon.pending { background: var(--accent-100); }
        .stat-icon.processing { background: var(--primary-100); }
        .stat-icon.shipped { background: var(--secondary-100); }
        .stat-icon.delivered { background: var(--secondary-100); }
        .stat-icon.cancelled { background: rgba(220, 38, 38, 0.1); }
        .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--slate-800); }
        .stat-label { font-size: 0.75rem; color: var(--slate-500); text-transform: uppercase; letter-spacing: 0.05em; }
        
        /* Filters */
        .filters-bar { background: var(--surface-base); border-radius: var(--radius-2xl); padding: var(--space-4) var(--space-5); box-shadow: var(--shadow-md); margin-bottom: var(--space-6); display: flex; gap: var(--space-4); align-items: center; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 200px; padding: var(--space-3) var(--space-4); border: 1px solid var(--slate-200); border-radius: var(--radius-xl); font-size: 0.875rem; background: var(--slate-50); transition: var(--transition-base); }
        .search-input:focus { outline: none; border-color: var(--primary-500); box-shadow: 0 0 0 3px var(--primary-100); background: white; }
        .filter-select { padding: var(--space-3) var(--space-4); border: 1px solid var(--slate-200); border-radius: var(--radius-xl); font-size: 0.875rem; background: var(--slate-50); cursor: pointer; min-width: 150px; }
        .filter-select:focus { outline: none; border-color: var(--primary-500); }
        .btn { padding: var(--space-3) var(--space-5); border: none; border-radius: var(--radius-xl); font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base); display: inline-flex; align-items: center; gap: var(--space-2); }
        .btn-primary { background: var(--gradient-primary); color: white; box-shadow: var(--shadow-colored); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -10px rgba(37, 99, 235, 0.4); }
        .btn-outline { background: transparent; border: 1px solid var(--slate-300); color: var(--slate-600); }
        .btn-outline:hover { background: var(--slate-100); }
        
        /* Table */
        .orders-table-container { background: var(--surface-base); border-radius: var(--radius-2xl); box-shadow: var(--shadow-lg); overflow: hidden; border: 1px solid var(--slate-200); }
        .orders-table { width: 100%; border-collapse: collapse; }
        .orders-table th { background: var(--slate-50); padding: var(--space-4) var(--space-5); text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--slate-600); border-bottom: 1px solid var(--slate-200); }
        .orders-table td { padding: var(--space-4) var(--space-5); border-bottom: 1px solid var(--slate-100); font-size: 0.875rem; vertical-align: middle; }
        .orders-table tr:hover { background: var(--slate-50); }
        .orders-table tr:last-child td { border-bottom: none; }
        
        /* Order ID */
        .order-id { font-family: var(--font-mono); font-weight: 600; color: var(--primary-600); }
        
        /* Customer info */
        .customer-info { display: flex; align-items: center; gap: var(--space-3); }
        .customer-avatar { width: 36px; height: 36px; border-radius: var(--radius-full); background: var(--gradient-primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.875rem; }
        .customer-name { font-weight: 500; color: var(--slate-800); }
        .customer-email { font-size: 0.75rem; color: var(--slate-500); }
        
        /* Status Badge - CLICKABLE */
        .status-badge { padding: var(--space-1) var(--space-3); border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: var(--space-1); cursor: pointer; transition: var(--transition-base); position: relative; }
        .status-badge:hover { transform: scale(1.05); box-shadow: var(--shadow-md); }
        .status-badge::before { content: ''; width: 6px; height: 6px; border-radius: var(--radius-full); }
        .status-badge.pending { background: var(--accent-100); color: var(--accent-700); }
        .status-badge.pending::before { background: var(--accent-500); }
        .status-badge.processing { background: var(--primary-100); color: var(--primary-700); }
        .status-badge.processing::before { background: var(--primary-500); }
        .status-badge.shipped { background: #dbeafe; color: #1d4ed8; }
        .status-badge.shipped::before { background: #3b82f6; }
        .status-badge.delivered { background: var(--secondary-100); color: var(--secondary-700); }
        .status-badge.delivered::before { background: var(--secondary-500); }
        .status-badge.cancelled { background: rgba(220, 38, 38, 0.1); color: var(--error); }
        .status-badge.cancelled::before { background: var(--error); }
        
        /* Actions */
        .actions-cell { display: flex; gap: var(--space-2); }
        .action-btn { width: 32px; height: 32px; border-radius: var(--radius-lg); border: 1px solid var(--slate-200); background: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-base); font-size: 0.875rem; }
        .action-btn:hover { background: var(--slate-100); border-color: var(--slate-300); }
        .action-btn.view:hover { color: var(--primary-600); border-color: var(--primary-300); }
        .action-btn.edit:hover { color: var(--accent-600); border-color: var(--accent-300); }
        .action-btn.delete:hover { color: var(--error); border-color: rgba(220, 38, 38, 0.3); }
        
        /* Status Dropdown */
        .status-dropdown { position: absolute; top: 100%; left: 0; background: white; border-radius: var(--radius-xl); box-shadow: var(--shadow-xl); border: 1px solid var(--slate-200); z-index: 1000; min-width: 180px; margin-top: var(--space-2); display: none; overflow: hidden; }
        .status-dropdown.show { display: block; animation: fadeIn 0.2s ease; }
        .status-option { padding: var(--space-3) var(--space-4); cursor: pointer; font-size: 0.875rem; display: flex; align-items: center; gap: var(--space-3); transition: var(--transition-base); }
        .status-option:hover { background: var(--slate-50); }
        .status-option.active { background: var(--primary-50); color: var(--primary-700); }
        .status-dot { width: 8px; height: 8px; border-radius: var(--radius-full); }
        .status-dot.pending { background: var(--accent-500); }
        .status-dot.processing { background: var(--primary-500); }
        .status-dot.shipped { background: #3b82f6; }
        .status-dot.delivered { background: var(--secondary-500); }
        .status-dot.cancelled { background: var(--error); }
        
        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; animation: fadeIn 0.2s ease; }
        .modal-content { background: white; border-radius: var(--radius-2xl); box-shadow: var(--shadow-2xl); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease; }
        .modal-header { padding: var(--space-5) var(--space-6); border-bottom: 1px solid var(--slate-200); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.25rem; font-weight: 700; color: var(--slate-800); }
        .modal-close { width: 32px; height: 32px; border-radius: var(--radius-lg); border: none; background: var(--slate-100); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition-base); }
        .modal-close:hover { background: var(--slate-200); }
        .modal-body { padding: var(--space-6); }
        .modal-footer { padding: var(--space-4) var(--space-6); border-top: 1px solid var(--slate-200); display: flex; justify-content: flex-end; gap: var(--space-3); }
        
        /* Order Details */
        .order-detail-row { display: flex; justify-content: space-between; padding: var(--space-3) 0; border-bottom: 1px solid var(--slate-100); }
        .order-detail-label { font-weight: 500; color: var(--slate-600); }
        .order-detail-value { color: var(--slate-800); }
        .order-items-list { margin-top: var(--space-4); }
        .order-item { display: flex; justify-content: space-between; align-items: center; padding: var(--space-3) var(--space-4); background: var(--slate-50); border-radius: var(--radius-lg); margin-bottom: var(--space-2); }
        .item-name { font-weight: 500; color: var(--slate-800); }
        .item-qty { font-size: 0.875rem; color: var(--slate-500); }
        .item-price { font-weight: 600; color: var(--primary-600); }
        
        /* Toast Notification */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 3000; display: flex; flex-direction: column; gap: var(--space-3); }
        .toast { background: white; border-radius: var(--radius-xl); box-shadow: var(--shadow-xl); padding: var(--space-4) var(--space-5); display: flex; align-items: center; gap: var(--space-3); min-width: 300px; animation: slideIn 0.3s ease; }
        .toast.success { border-left: 4px solid var(--secondary-500); }
        .toast.error { border-left: 4px solid var(--error); }
        .toast.info { border-left: 4px solid var(--primary-500); }
        .toast-icon { font-size: 1.25rem; }
        .toast-message { flex: 1; font-size: 0.875rem; color: var(--slate-700); }
        .toast-close { cursor: pointer; color: var(--slate-400); }
        
        /* Loading */
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--slate-200); border-top-color: var(--primary-500); border-radius: var(--radius-full); animation: spin 0.8s linear infinite; }
        .loading-row { display: flex; justify-content: center; padding: var(--space-8); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Responsive */
        @media (max-width: 1024px) { 
            .sidebar { transform: translateX(-100%); } 
            .main-content { margin-left: 0; }
        }
        
        /* Empty State */
        .empty-state { text-align: center; padding: var(--space-12); }
        .empty-icon { font-size: 4rem; margin-bottom: var(--space-4); }
        .empty-title { font-size: 1.25rem; font-weight: 600; color: var(--slate-700); margin-bottom: var(--space-2); }
        .empty-desc { color: var(--slate-500); }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo">üå∏ Flores Victoria</div>
                    <div class="logo-subtitle">Enterprise Dashboard</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <ul class="nav-list">
                        <li class="nav-item"><a href="/" class="nav-link"><span class="nav-icon">üè†</span>Dashboard</a></li>
                        <li class="nav-item"><a href="/control-center.html" class="nav-link"><span class="nav-icon">üîß</span>Centro de Control</a></li>
                        <li class="nav-item"><a href="/analytics.html" class="nav-link"><span class="nav-icon">üìä</span>Analytics</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Gesti√≥n de Negocio</div>
                    <ul class="nav-list">
                        <li class="nav-item"><a href="/products.html" class="nav-link"><span class="nav-icon">üõçÔ∏è</span>Productos</a></li>
                        <li class="nav-item"><a href="/orders.html" class="nav-link active"><span class="nav-icon">üì¶</span>Pedidos</a></li>
                        <li class="nav-item"><a href="/customers.html" class="nav-link"><span class="nav-icon">üë•</span>Clientes</a></li>
                        <li class="nav-item"><a href="/inventory.html" class="nav-link"><span class="nav-icon">üìã</span>Inventario</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Sistema</div>
                    <ul class="nav-list">
                        <li class="nav-item"><a href="/settings.html" class="nav-link"><span class="nav-icon">‚öôÔ∏è</span>Configuraci√≥n</a></li>
                        <li class="nav-item"><a href="/users.html" class="nav-link"><span class="nav-icon">üë§</span>Usuarios</a></li>
                        <li class="nav-item"><a href="/documentation.html" class="nav-link"><span class="nav-icon">üìö</span>Documentaci√≥n</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <section class="page-header">
                <div class="page-header-content">
                    <div>
                        <h1 class="page-title">üì¶ Gesti√≥n de Pedidos</h1>
                        <p class="page-subtitle">Administra y actualiza el estado de los pedidos en tiempo real</p>
                    </div>
                    <button class="btn btn-primary" onclick="refreshOrders()">
                        ÔøΩÔøΩ Actualizar
                    </button>
                </div>
            </section>

            <section class="content-section">
                <!-- Stats -->
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon pending">‚è≥</div>
                        <div>
                            <div class="stat-value" id="stat-pending">-</div>
                            <div class="stat-label">Pendientes</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon processing">üîÑ</div>
                        <div>
                            <div class="stat-value" id="stat-processing">-</div>
                            <div class="stat-label">En Proceso</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon shipped">üöö</div>
                        <div>
                            <div class="stat-value" id="stat-shipped">-</div>
                            <div class="stat-label">Enviados</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon delivered">‚úÖ</div>
                        <div>
                            <div class="stat-value" id="stat-delivered">-</div>
                            <div class="stat-label">Entregados</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon cancelled">‚ùå</div>
                        <div>
                            <div class="stat-value" id="stat-cancelled">-</div>
                            <div class="stat-label">Cancelados</div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <input type="text" class="search-input" placeholder="üîç Buscar por ID, cliente o email..." id="searchInput" oninput="filterOrders()">
                    <select class="filter-select" id="statusFilter" onchange="filterOrders()">
                        <option value="">Todos los estados</option>
                        <option value="pending">‚è≥ Pendiente</option>
                        <option value="processing">üîÑ En Proceso</option>
                        <option value="shipped">üöö Enviado</option>
                        <option value="delivered">‚úÖ Entregado</option>
                        <option value="cancelled">‚ùå Cancelado</option>
                    </select>
                    <select class="filter-select" id="dateFilter" onchange="filterOrders()">
                        <option value="">Todas las fechas</option>
                        <option value="today">Hoy</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este mes</option>
                    </select>
                </div>

                <!-- Orders Table -->
                <div class="orders-table-container">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>ID Pedido</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado (click para cambiar)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr class="loading-row">
                                <td colspan="6">
                                    <div class="loading-spinner"></div>
                                    <span style="margin-left: 10px;">Cargando pedidos...</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal-overlay" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì¶ Detalles del Pedido</h2>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="orderModalBody">
                <!-- Content loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Configuration
        const API_BASE_URL = 'https://api-gateway-production-b02f.up.railway.app';
        let ordersData = [];
        let filteredOrders = [];
        let currentOpenDropdown = null;
        
        // Status Labels
        const STATUS_LABELS = {
            'pending': '‚è≥ Pendiente',
            'processing': 'üîÑ En Proceso',
            'shipped': 'üöö Enviado',
            'delivered': '‚úÖ Entregado',
            'cancelled': '‚ùå Cancelado'
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadOrders();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.status-badge') && !e.target.closest('.status-dropdown')) {
                    closeAllDropdowns();
                }
            });
        });
        
        // Load Orders from API
        async function loadOrders() {
            try {
                showLoading();
                
                // Try to get auth token from localStorage
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = 'Bearer ' + token;
                }
                
                const response = await fetch(API_BASE_URL + '/api/orders', { headers });
                
                if (response.ok) {
                    const data = await response.json();
                    ordersData = Array.isArray(data) ? data : (data.orders || data.data || []);
                } else {
                    // If API fails, use demo data
                    console.warn('API returned ' + response.status + ', using demo data');
                    ordersData = generateDemoOrders();
                }
                
                filteredOrders = [...ordersData];
                updateStats();
                renderOrders();
                showToast('Pedidos cargados correctamente', 'success');
            } catch (error) {
                console.error('Error loading orders:', error);
                ordersData = generateDemoOrders();
                filteredOrders = [...ordersData];
                updateStats();
                renderOrders();
                showToast('Usando datos de demostraci√≥n', 'info');
            }
        }
        
        // Generate Demo Orders
        function generateDemoOrders() {
            const customers = [
                { name: 'Mar√≠a Garc√≠a', email: 'maria@email.com' },
                { name: 'Carlos L√≥pez', email: 'carlos@email.com' },
                { name: 'Ana Mart√≠nez', email: 'ana@email.com' },
                { name: 'Pedro S√°nchez', email: 'pedro@email.com' },
                { name: 'Laura Fern√°ndez', email: 'laura@email.com' },
                { name: 'Jos√© Rodr√≠guez', email: 'jose@email.com' },
                { name: 'Carmen D√≠az', email: 'carmen@email.com' },
                { name: 'Miguel Torres', email: 'miguel@email.com' }
            ];
            
            const statuses = ['pending', 'processing', 'shipped', 'delivered', 'cancelled'];
            const products = [
                { name: 'Ramo Primavera', price: 45.99 },
                { name: 'Orqu√≠dea Premium', price: 89.99 },
                { name: 'Rosas Rojas x12', price: 65.00 },
                { name: 'Girasoles', price: 35.99 },
                { name: 'Bouquet Mixto', price: 55.00 }
            ];
            
            return Array.from({ length: 15 }, (_, i) => {
                const customer = customers[Math.floor(Math.random() * customers.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const numItems = Math.floor(Math.random() * 3) + 1;
                const items = Array.from({ length: numItems }, () => {
                    const product = products[Math.floor(Math.random() * products.length)];
                    return {
                        name: product.name,
                        quantity: Math.floor(Math.random() * 3) + 1,
                        price: product.price
                    };
                });
                const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 30));
                
                return {
                    _id: 'ORD-' + (1000 + i),
                    id: 'ORD-' + (1000 + i),
                    customer: customer,
                    customerName: customer.name,
                    customerEmail: customer.email,
                    createdAt: date.toISOString(),
                    total: total,
                    status: status,
                    items: items,
                    shippingAddress: {
                        street: 'Calle Principal ' + (100 + i),
                        city: 'Ciudad de M√©xico',
                        zipCode: '01234'
                    }
                };
            }).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        // Update Statistics
        function updateStats() {
            const stats = {
                pending: 0,
                processing: 0,
                shipped: 0,
                delivered: 0,
                cancelled: 0
            };
            
            ordersData.forEach(order => {
                if (stats.hasOwnProperty(order.status)) {
                    stats[order.status]++;
                }
            });
            
            Object.keys(stats).forEach(key => {
                const el = document.getElementById('stat-' + key);
                if (el) el.textContent = stats[key];
            });
        }
        
        // Render Orders Table
        function renderOrders() {
            const tbody = document.getElementById('ordersTableBody');
            
            if (filteredOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">No hay pedidos</div><div class="empty-desc">No se encontraron pedidos con los filtros aplicados</div></div></td></tr>';
                return;
            }
            
            tbody.innerHTML = filteredOrders.map(order => {
                const orderId = order._id || order.id || 'N/A';
                const customerName = order.customerName || order.customer?.name || 'Cliente';
                const customerEmail = order.customerEmail || order.customer?.email || 'email@example.com';
                const initials = customerName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const date = new Date(order.createdAt || order.date || Date.now());
                const formattedDate = date.toLocaleDateString('es-MX', { day: '2-digit', month: 'short', year: 'numeric' });
                const total = typeof order.total === 'number' ? order.total.toFixed(2) : '0.00';
                const status = order.status || 'pending';
                
                return '<tr data-order-id="' + orderId + '">' +
                    '<td><span class="order-id">' + orderId + '</span></td>' +
                    '<td>' +
                        '<div class="customer-info">' +
                            '<div class="customer-avatar">' + initials + '</div>' +
                            '<div>' +
                                '<div class="customer-name">' + customerName + '</div>' +
                                '<div class="customer-email">' + customerEmail + '</div>' +
                            '</div>' +
                        '</div>' +
                    '</td>' +
                    '<td>' + formattedDate + '</td>' +
                    '<td><strong>$' + total + '</strong></td>' +
                    '<td style="position: relative;">' +
                        '<span class="status-badge ' + status + '" onclick="toggleStatusDropdown(event, \'' + orderId + '\')">' +
                            STATUS_LABELS[status] +
                        '</span>' +
                        '<div class="status-dropdown" id="dropdown-' + orderId + '">' +
                            Object.entries(STATUS_LABELS).map(([key, label]) => 
                                '<div class="status-option ' + (key === status ? 'active' : '') + '" onclick="updateOrderStatus(\'' + orderId + '\', \'' + key + '\')">' +
                                    '<span class="status-dot ' + key + '"></span>' +
                                    label +
                                '</div>'
                            ).join('') +
                        '</div>' +
                    '</td>' +
                    '<td>' +
                        '<div class="actions-cell">' +
                            '<button class="action-btn view" onclick="viewOrderDetails(\'' + orderId + '\')" title="Ver detalles">üëÅÔ∏è</button>' +
                            '<button class="action-btn edit" onclick="editOrder(\'' + orderId + '\')" title="Editar">‚úèÔ∏è</button>' +
                            '<button class="action-btn delete" onclick="deleteOrder(\'' + orderId + '\')" title="Eliminar">üóëÔ∏è</button>' +
                        '</div>' +
                    '</td>' +
                '</tr>';
            }).join('');
        }
        
        // Toggle Status Dropdown
        function toggleStatusDropdown(event, orderId) {
            event.stopPropagation();
            
            const dropdown = document.getElementById('dropdown-' + orderId);
            const isCurrentlyOpen = dropdown.classList.contains('show');
            
            closeAllDropdowns();
            
            if (!isCurrentlyOpen) {
                dropdown.classList.add('show');
                currentOpenDropdown = dropdown;
            }
        }
        
        // Close All Dropdowns
        function closeAllDropdowns() {
            document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
            currentOpenDropdown = null;
        }
        
        // Update Order Status
        async function updateOrderStatus(orderId, newStatus) {
            closeAllDropdowns();
            
            // Find order
            const orderIndex = ordersData.findIndex(o => (o._id || o.id) === orderId);
            if (orderIndex === -1) return;
            
            const oldStatus = ordersData[orderIndex].status;
            
            // Optimistic update
            ordersData[orderIndex].status = newStatus;
            filterOrders();
            
            try {
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                const headers = {
                    'Content-Type': 'application/json'
                };
                if (token) {
                    headers['Authorization'] = 'Bearer ' + token;
                }
                
                // Try to update via API
                const response = await fetch(API_BASE_URL + '/api/orders/' + orderId + '/status', {
                    method: 'PATCH',
                    headers: headers,
                    body: JSON.stringify({ status: newStatus })
                });
                
                if (!response.ok) {
                    // Also try PUT method
                    const response2 = await fetch(API_BASE_URL + '/api/orders/' + orderId, {
                        method: 'PUT',
                        headers: headers,
                        body: JSON.stringify({ status: newStatus })
                    });
                    
                    if (!response2.ok) {
                        console.warn('API update returned ' + response.status);
                    }
                }
                
                showToast('Estado actualizado: ' + STATUS_LABELS[newStatus], 'success');
            } catch (error) {
                console.error('Error updating status:', error);
                // Keep local change but notify
                showToast('Estado actualizado localmente', 'info');
            }
            
            updateStats();
        }
        
        // Filter Orders
        function filterOrders() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredOrders = ordersData.filter(order => {
                const orderId = (order._id || order.id || '').toLowerCase();
                const customerName = (order.customerName || order.customer?.name || '').toLowerCase();
                const customerEmail = (order.customerEmail || order.customer?.email || '').toLowerCase();
                
                // Search filter
                const matchesSearch = !search || 
                    orderId.includes(search) || 
                    customerName.includes(search) || 
                    customerEmail.includes(search);
                
                // Status filter
                const matchesStatus = !status || order.status === status;
                
                // Date filter
                let matchesDate = true;
                if (dateFilter) {
                    const orderDate = new Date(order.createdAt || order.date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    
                    if (dateFilter === 'today') {
                        matchesDate = orderDate >= today;
                    } else if (dateFilter === 'week') {
                        const weekAgo = new Date(today);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        matchesDate = orderDate >= weekAgo;
                    } else if (dateFilter === 'month') {
                        const monthAgo = new Date(today);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        matchesDate = orderDate >= monthAgo;
                    }
                }
                
                return matchesSearch && matchesStatus && matchesDate;
            });
            
            renderOrders();
        }
        
        // View Order Details
        function viewOrderDetails(orderId) {
            const order = ordersData.find(o => (o._id || o.id) === orderId);
            if (!order) return;
            
            const customerName = order.customerName || order.customer?.name || 'Cliente';
            const customerEmail = order.customerEmail || order.customer?.email || '';
            const date = new Date(order.createdAt || order.date || Date.now());
            const total = typeof order.total === 'number' ? order.total.toFixed(2) : '0.00';
            const status = order.status || 'pending';
            const items = order.items || [];
            const address = order.shippingAddress || {};
            
            const modalBody = document.getElementById('orderModalBody');
            modalBody.innerHTML = '' +
                '<div class="order-detail-row"><span class="order-detail-label">ID Pedido:</span><span class="order-detail-value order-id">' + orderId + '</span></div>' +
                '<div class="order-detail-row"><span class="order-detail-label">Cliente:</span><span class="order-detail-value">' + customerName + '</span></div>' +
                '<div class="order-detail-row"><span class="order-detail-label">Email:</span><span class="order-detail-value">' + customerEmail + '</span></div>' +
                '<div class="order-detail-row"><span class="order-detail-label">Fecha:</span><span class="order-detail-value">' + date.toLocaleString('es-MX') + '</span></div>' +
                '<div class="order-detail-row"><span class="order-detail-label">Estado:</span><span class="status-badge ' + status + '">' + STATUS_LABELS[status] + '</span></div>' +
                '<div class="order-detail-row"><span class="order-detail-label">Direcci√≥n:</span><span class="order-detail-value">' + (address.street || 'N/A') + ', ' + (address.city || '') + ' ' + (address.zipCode || '') + '</span></div>' +
                '<hr style="margin: 16px 0; border: none; border-top: 1px solid #e2e8f0;">' +
                '<h4 style="margin-bottom: 12px; color: #1e293b;">üì¶ Productos:</h4>' +
                '<div class="order-items-list">' +
                    (items.length > 0 ? items.map(item => 
                        '<div class="order-item"><div><span class="item-name">' + (item.name || item.productName || 'Producto') + '</span><span class="item-qty"> x' + (item.quantity || 1) + '</span></div><span class="item-price">$' + ((item.price || 0) * (item.quantity || 1)).toFixed(2) + '</span></div>'
                    ).join('') : '<div class="order-item"><span>Sin productos</span></div>') +
                '</div>' +
                '<hr style="margin: 16px 0; border: none; border-top: 1px solid #e2e8f0;">' +
                '<div class="order-detail-row"><span class="order-detail-label" style="font-size: 1.1rem; font-weight: 700;">Total:</span><span class="order-detail-value" style="font-size: 1.25rem; font-weight: 700; color: #2563eb;">$' + total + '</span></div>';
            
            document.getElementById('orderModal').classList.add('show');
        }
        
        // Edit Order
        function editOrder(orderId) {
            showToast('Funci√≥n de edici√≥n pr√≥ximamente', 'info');
        }
        
        // Delete Order
        async function deleteOrder(orderId) {
            if (!confirm('¬øEst√°s seguro de eliminar el pedido ' + orderId + '?')) return;
            
            const orderIndex = ordersData.findIndex(o => (o._id || o.id) === orderId);
            if (orderIndex === -1) return;
            
            ordersData.splice(orderIndex, 1);
            filterOrders();
            updateStats();
            
            try {
                const token = localStorage.getItem('adminToken') || localStorage.getItem('token');
                const headers = { 'Content-Type': 'application/json' };
                if (token) headers['Authorization'] = 'Bearer ' + token;
                
                await fetch(API_BASE_URL + '/api/orders/' + orderId, {
                    method: 'DELETE',
                    headers: headers
                });
            } catch (error) {
                console.error('Error deleting:', error);
            }
            
            showToast('Pedido eliminado', 'success');
        }
        
        // Close Modal
        function closeModal() {
            document.getElementById('orderModal').classList.remove('show');
        }
        
        // Refresh Orders
        function refreshOrders() {
            loadOrders();
        }
        
        // Show Loading
        function showLoading() {
            document.getElementById('ordersTableBody').innerHTML = '<tr class="loading-row"><td colspan="6"><div class="loading-spinner"></div><span style="margin-left: 10px;">Cargando pedidos...</span></td></tr>';
        }
        
        // Show Toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast ' + type;
            
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            toast.innerHTML = '<span class="toast-icon">' + icons[type] + '</span><span class="toast-message">' + message + '</span><span class="toast-close" onclick="this.parentElement.remove()">‚úï</span>';
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
        
        // Close modal on overlay click
        document.getElementById('orderModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
    </script>
</body>
</html>
