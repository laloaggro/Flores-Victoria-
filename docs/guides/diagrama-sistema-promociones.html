<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Sistema de Promociones Automatizado - Flores Victoria</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e74c3c;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #fff;
            color: #e74c3c;
        }

        .tab.active {
            background: white;
            color: #e74c3c;
            border-bottom-color: #e74c3c;
        }

        .content {
            padding: 40px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .architecture-diagram {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .layer {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .layer:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .layer h3 {
            color: #e74c3c;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .layer h3 .icon {
            font-size: 1.8em;
        }

        .component {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
            transition: all 0.3s;
        }

        .component:hover {
            border-left-width: 8px;
            padding-left: 20px;
        }

        .component h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .component p {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .component .tech {
            display: inline-block;
            background: #ecf0f1;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            color: #34495e;
            margin-top: 8px;
            margin-right: 5px;
        }

        .flow-diagram {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #e74c3c;
        }

        .flow-step .number {
            background: #e74c3c;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .flow-step .content {
            flex: 1;
        }

        .flow-step h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .flow-step p {
            color: #7f8c8d;
            line-height: 1.6;
        }

        .arrow {
            text-align: center;
            color: #e74c3c;
            font-size: 2em;
            margin: 10px 0;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.8;
            overflow-x: auto;
            margin: 20px 0;
        }

        .code-block .keyword { color: #e74c3c; }
        .code-block .string { color: #2ecc71; }
        .code-block .number { color: #f39c12; }
        .code-block .comment { color: #95a5a6; }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s;
        }

        .feature-card:hover {
            transform: scale(1.05);
        }

        .feature-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature-card h4 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .feature-card p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
            margin-top: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background: #e74c3c;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .timeline-item:nth-child(odd) {
            flex-direction: row;
        }

        .timeline-item:nth-child(even) {
            flex-direction: row-reverse;
        }

        .timeline-content {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 0 30px;
        }

        .timeline-marker {
            width: 20px;
            height: 20px;
            background: #e74c3c;
            border: 4px solid white;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            box-shadow: 0 0 0 4px #e74c3c;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #e74c3c;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .stat-card .label {
            color: #7f8c8d;
            font-size: 1em;
        }

        .info-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #856404;
            line-height: 1.6;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .success-box h4 {
            color: #155724;
            margin-bottom: 10px;
        }

        .success-box p {
            color: #155724;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .architecture-diagram {
                grid-template-columns: 1fr;
            }

            .timeline::before {
                left: 20px;
            }

            .timeline-item {
                flex-direction: column !important;
                align-items: flex-start;
            }

            .timeline-marker {
                left: 20px;
            }

            .timeline-content {
                margin-left: 60px;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Sistema de Promociones Automatizado</h1>
            <p>Arquitectura completa para gesti√≥n inteligente de descuentos y ofertas</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">üìã Resumen</button>
            <button class="tab" onclick="showTab('architecture')">üèóÔ∏è Arquitectura</button>
            <button class="tab" onclick="showTab('flow')">üîÑ Flujo de Datos</button>
            <button class="tab" onclick="showTab('models')">üìä Modelos</button>
            <button class="tab" onclick="showTab('api')">üîå APIs</button>
            <button class="tab" onclick="showTab('frontend')">üé® Frontend</button>
            <button class="tab" onclick="showTab('timeline')">‚è±Ô∏è Implementaci√≥n</button>
        </div>

        <div class="content">
            <!-- TAB: RESUMEN -->
            <div id="overview" class="tab-panel active">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üìã Resumen del Sistema</h2>
                
                <div class="info-box">
                    <h4>üéØ Objetivo</h4>
                    <p>Sistema automatizado que gestiona promociones, descuentos y ofertas especiales aplicables a productos individuales o categor√≠as completas, con activaci√≥n/desactivaci√≥n programada y c√°lculo autom√°tico de precios finales.</p>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="icon">‚è∞</div>
                        <h4>Programaci√≥n Autom√°tica</h4>
                        <p>Activa y desactiva promociones seg√∫n fechas/horas configuradas</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">üí∞</div>
                        <h4>Descuentos Flexibles</h4>
                        <p>Porcentaje fijo, descuento absoluto, 2x1, env√≠o gratis</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">üéØ</div>
                        <h4>Segmentaci√≥n</h4>
                        <p>Aplica a productos, categor√≠as, ocasiones o clientes espec√≠ficos</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">üìä</div>
                        <h4>Analytics</h4>
                        <p>M√©tricas de conversi√≥n, ingresos por promo, efectividad</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">üîî</div>
                        <h4>Notificaciones</h4>
                        <p>Alertas de inicio/fin, performance, stock cr√≠tico</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">üõ°Ô∏è</div>
                        <h4>Prioridades</h4>
                        <p>Gesti√≥n inteligente de promociones superpuestas</p>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="value">+35%</div>
                        <div class="label">Incremento en conversi√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">-70%</div>
                        <div class="label">Reducci√≥n tiempo gesti√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">24/7</div>
                        <div class="label">Operaci√≥n autom√°tica</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">100%</div>
                        <div class="label">Precisi√≥n en c√°lculos</div>
                    </div>
                </div>
            </div>

            <!-- TAB: ARQUITECTURA -->
            <div id="architecture" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üèóÔ∏è Arquitectura del Sistema</h2>
                
                <div class="architecture-diagram">
                    <div class="layer">
                        <h3><span class="icon">üíæ</span> Capa de Datos</h3>
                        
                        <div class="component">
                            <h4>Promotion Model</h4>
                            <p>Schema MongoDB para promociones con validaciones, √≠ndices y m√©todos de consulta</p>
                            <span class="tech">Mongoose</span>
                            <span class="tech">MongoDB</span>
                        </div>

                        <div class="component">
                            <h4>Product Model (extendido)</h4>
                            <p>Campos adicionales: current_promotion, discount_price, promotion_expires_at</p>
                            <span class="tech">Hooks</span>
                            <span class="tech">Virtual Fields</span>
                        </div>

                        <div class="component">
                            <h4>PromotionHistory</h4>
                            <p>Registro hist√≥rico de todas las promociones ejecutadas para analytics</p>
                            <span class="tech">Time Series</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">‚öôÔ∏è</span> Capa de Servicios</h3>
                        
                        <div class="component">
                            <h4>Promotion Service</h4>
                            <p>L√≥gica de negocio: CRUD, validaciones, aplicaci√≥n de descuentos</p>
                            <span class="tech">Node.js</span>
                            <span class="tech">Express</span>
                        </div>

                        <div class="component">
                            <h4>Scheduler Service</h4>
                            <p>Cron jobs para activar/desactivar promociones autom√°ticamente</p>
                            <span class="tech">node-cron</span>
                            <span class="tech">Bull Queue</span>
                        </div>

                        <div class="component">
                            <h4>Price Calculator</h4>
                            <p>Motor de c√°lculo de precios finales con prioridades y restricciones</p>
                            <span class="tech">Business Logic</span>
                        </div>

                        <div class="component">
                            <h4>Analytics Service</h4>
                            <p>M√©tricas de conversi√≥n, ROI, productos m√°s vendidos en promo</p>
                            <span class="tech">Analytics</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">üîå</span> Capa API</h3>
                        
                        <div class="component">
                            <h4>REST Endpoints</h4>
                            <p>GET/POST/PUT/DELETE /api/promotions para gesti√≥n completa</p>
                            <span class="tech">REST</span>
                            <span class="tech">JWT Auth</span>
                        </div>

                        <div class="component">
                            <h4>Middleware</h4>
                            <p>ApplyPromotions: intercepta respuestas de productos y aplica descuentos activos</p>
                            <span class="tech">Middleware</span>
                        </div>

                        <div class="component">
                            <h4>WebSockets</h4>
                            <p>Notificaciones en tiempo real de cambios de precio y nuevas ofertas</p>
                            <span class="tech">Socket.io</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">üé®</span> Capa Frontend</h3>
                        
                        <div class="component">
                            <h4>Admin Panel</h4>
                            <p>Interfaz para crear/editar promociones, vista calendario, preview</p>
                            <span class="tech">React</span>
                            <span class="tech">Material-UI</span>
                        </div>

                        <div class="component">
                            <h4>Product Cards</h4>
                            <p>Badges de descuento, precio original tachado, countdown timer</p>
                            <span class="tech">Web Components</span>
                        </div>

                        <div class="component">
                            <h4>Deals Page</h4>
                            <p>P√°gina dedicada con todas las ofertas activas y filtros</p>
                            <span class="tech">Vanilla JS</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">üîß</span> Utilidades</h3>
                        
                        <div class="component">
                            <h4>Email Templates</h4>
                            <p>Plantillas para notificar nuevas promociones a clientes</p>
                            <span class="tech">Handlebars</span>
                        </div>

                        <div class="component">
                            <h4>Cache Layer</h4>
                            <p>Redis para cachear promociones activas y mejorar performance</p>
                            <span class="tech">Redis</span>
                        </div>

                        <div class="component">
                            <h4>Logger</h4>
                            <p>Tracking de aplicaci√≥n/desactivaci√≥n de promociones</p>
                            <span class="tech">Winston</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: FLUJO -->
            <div id="flow" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üîÑ Flujo de Datos</h2>
                
                <div class="flow-diagram">
                    <h3 style="margin-bottom: 20px;">üìù Creaci√≥n de Promoci√≥n</h3>
                    
                    <div class="flow-step">
                        <div class="number">1</div>
                        <div class="content">
                            <h4>Admin crea promoci√≥n</h4>
                            <p>Define tipo, descuento, fechas, productos/categor√≠as aplicables, prioridad y condiciones</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">2</div>
                        <div class="content">
                            <h4>Validaci√≥n</h4>
                            <p>Sistema valida fechas, productos existentes, conflictos con otras promos, permisos</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">3</div>
                        <div class="content">
                            <h4>Almacenamiento</h4>
                            <p>Promoci√≥n se guarda en BD con estado "scheduled" y se programa en el scheduler</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">4</div>
                        <div class="content">
                            <h4>Activaci√≥n autom√°tica</h4>
                            <p>Cron job detecta fecha inicio y cambia estado a "active", actualiza cache Redis</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">5</div>
                        <div class="content">
                            <h4>Aplicaci√≥n en productos</h4>
                            <p>Middleware intercepta GET /api/products y calcula precios con descuento aplicado</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">6</div>
                        <div class="content">
                            <h4>Frontend renderiza</h4>
                            <p>Muestra badge "30% OFF", precio original tachado, countdown si aplica</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">7</div>
                        <div class="content">
                            <h4>Analytics tracking</h4>
                            <p>Registra views, clicks, conversiones, ingresos generados por la promoci√≥n</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">8</div>
                        <div class="content">
                            <h4>Expiraci√≥n autom√°tica</h4>
                            <p>Cron job detecta fecha fin, desactiva promo, limpia cache, archiva en history</p>
                        </div>
                    </div>
                </div>

                <div class="flow-diagram" style="margin-top: 40px;">
                    <h3 style="margin-bottom: 20px;">üõí Compra con Promoci√≥n</h3>
                    
                    <div class="flow-step">
                        <div class="number">1</div>
                        <div class="content">
                            <h4>Usuario ve producto</h4>
                            <p>GET /api/products/AML001 ‚Üí Middleware aplica promoci√≥n activa</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">2</div>
                        <div class="content">
                            <h4>A√±ade al carrito</h4>
                            <p>Carrito guarda precio promocional + ID de promoci√≥n aplicada</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">3</div>
                        <div class="content">
                            <h4>Validaci√≥n pre-checkout</h4>
                            <p>Sistema verifica que promoci√≥n siga activa antes de procesar pago</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">4</div>
                        <div class="content">
                            <h4>Registro en orden</h4>
                            <p>Orden almacena: precio original, descuento aplicado, ID promoci√≥n, ahorro total</p>
                        </div>
                    </div>

                    <div class="flow-step">
                        <div class="number">5</div>
                        <div class="content">
                            <h4>Analytics</h4>
                            <p>Incrementa contadores: conversiones +1, revenue += amount, ROI recalculado</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: MODELOS -->
            <div id="models" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üìä Modelos de Datos</h2>
                
                <h3 style="margin: 30px 0 15px;">Promotion Schema</h3>
                <div class="code-block">
<span class="keyword">const</span> promotionSchema = <span class="keyword">new</span> mongoose.Schema({
  <span class="comment">// Identificaci√≥n</span>
  code: { type: String, required: <span class="keyword">true</span>, unique: <span class="keyword">true</span> }, <span class="comment">// Ej: "NAVIDAD2025"</span>
  name: { type: String, required: <span class="keyword">true</span> },
  description: String,
  
  <span class="comment">// Tipo y valor del descuento</span>
  type: {
    type: String,
    enum: [<span class="string">'percentage'</span>, <span class="string">'fixed_amount'</span>, <span class="string">'free_shipping'</span>, <span class="string">'2x1'</span>, <span class="string">'3x2'</span>],
    required: <span class="keyword">true</span>
  },
  value: { type: Number, required: <span class="keyword">true</span> }, <span class="comment">// 20 (para 20%) o 5000 (para $5000 off)</span>
  
  <span class="comment">// Fechas y vigencia</span>
  start_date: { type: Date, required: <span class="keyword">true</span> },
  end_date: { type: Date, required: <span class="keyword">true</span> },
  timezone: { type: String, default: <span class="string">'America/Santiago'</span> },
  
  <span class="comment">// Aplicabilidad</span>
  applies_to: {
    type: String,
    enum: [<span class="string">'all'</span>, <span class="string">'products'</span>, <span class="string">'categories'</span>, <span class="string">'occasions'</span>],
    default: <span class="string">'all'</span>
  },
  product_ids: [String], <span class="comment">// IDs espec√≠ficos si applies_to = 'products'</span>
  category_slugs: [String], <span class="comment">// Ej: ['aniversario-amor', 'cumpleanos']</span>
  occasion_slugs: [String],
  
  <span class="comment">// Condiciones</span>
  min_purchase_amount: { type: Number, default: <span class="number">0</span> },
  max_uses: Number, <span class="comment">// L√≠mite global de usos</span>
  max_uses_per_user: { type: Number, default: <span class="number">1</span> },
  
  <span class="comment">// Estado y prioridad</span>
  status: {
    type: String,
    enum: [<span class="string">'scheduled'</span>, <span class="string">'active'</span>, <span class="string">'paused'</span>, <span class="string">'expired'</span>, <span class="string">'cancelled'</span>],
    default: <span class="string">'scheduled'</span>
  },
  priority: { type: Number, default: <span class="number">0</span> }, <span class="comment">// Mayor n√∫mero = mayor prioridad</span>
  
  <span class="comment">// Analytics</span>
  stats: {
    views: { type: Number, default: <span class="number">0</span> },
    clicks: { type: Number, default: <span class="number">0</span> },
    conversions: { type: Number, default: <span class="number">0</span> },
    revenue: { type: Number, default: <span class="number">0</span> },
    total_discount_given: { type: Number, default: <span class="number">0</span> }
  },
  
  <span class="comment">// Metadatos</span>
  created_by: String,
  updated_by: String
}, { timestamps: <span class="keyword">true</span> });

<span class="comment">// √çndices</span>
promotionSchema.index({ status: <span class="number">1</span>, start_date: <span class="number">1</span>, end_date: <span class="number">1</span> });
promotionSchema.index({ code: <span class="number">1</span> });
promotionSchema.index({ category_slugs: <span class="number">1</span> });
                </div>

                <h3 style="margin: 30px 0 15px;">Product Schema (extensi√≥n)</h3>
                <div class="code-block">
<span class="comment">// Agregar estos campos al Product model existente:</span>

{
  <span class="comment">// Promoci√≥n actual aplicada</span>
  current_promotion: {
    promotion_id: mongoose.Schema.Types.ObjectId,
    code: String,
    discount_type: String,
    discount_value: Number,
    applied_at: Date
  },
  
  <span class="comment">// Precio con descuento (calculado)</span>
  discount_price: { type: Number },
  
  <span class="comment">// % de descuento (para mostrar badge)</span>
  discount_percentage: { type: Number },
  
  <span class="comment">// Fecha de expiraci√≥n de la promo</span>
  promotion_expires_at: Date
}

<span class="comment">// Virtual para calcular ahorro</span>
productSchema.virtual(<span class="string">'savings'</span>).<span class="keyword">get</span>(<span class="keyword">function</span>() {
  <span class="keyword">if</span> (<span class="keyword">this</span>.discount_price) {
    <span class="keyword">return</span> <span class="keyword">this</span>.price - <span class="keyword">this</span>.discount_price;
  }
  <span class="keyword">return</span> <span class="number">0</span>;
});
                </div>

                <h3 style="margin: 30px 0 15px;">PromotionHistory Schema</h3>
                <div class="code-block">
<span class="keyword">const</span> historySchema = <span class="keyword">new</span> mongoose.Schema({
  promotion_id: { type: mongoose.Schema.Types.ObjectId, required: <span class="keyword">true</span> },
  promotion_code: String,
  action: {
    type: String,
    enum: [<span class="string">'created'</span>, <span class="string">'activated'</span>, <span class="string">'applied'</span>, <span class="string">'paused'</span>, <span class="string">'expired'</span>, <span class="string">'cancelled'</span>]
  },
  product_id: String, <span class="comment">// Si acci√≥n = 'applied'</span>
  order_id: String,
  user_id: String,
  discount_amount: Number,
  metadata: mongoose.Schema.Types.Mixed,
  timestamp: { type: Date, default: Date.now }
});
                </div>
            </div>

            <!-- TAB: API -->
            <div id="api" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üîå Endpoints API</h2>
                
                <div class="flow-diagram">
                    <h3>Gesti√≥n de Promociones</h3>
                    
                    <div class="component">
                        <h4>POST /api/promotions</h4>
                        <p><strong>Crear nueva promoci√≥n</strong></p>
                        <div class="code-block" style="font-size: 0.85em;">
{
  <span class="string">"code"</span>: <span class="string">"NAVIDAD2025"</span>,
  <span class="string">"name"</span>: <span class="string">"Promoci√≥n Navidad"</span>,
  <span class="string">"type"</span>: <span class="string">"percentage"</span>,
  <span class="string">"value"</span>: <span class="number">25</span>,
  <span class="string">"start_date"</span>: <span class="string">"2025-12-20T00:00:00Z"</span>,
  <span class="string">"end_date"</span>: <span class="string">"2025-12-26T23:59:59Z"</span>,
  <span class="string">"applies_to"</span>: <span class="string">"categories"</span>,
  <span class="string">"category_slugs"</span>: [<span class="string">"aniversario-amor"</span>, <span class="string">"cumpleanos"</span>]
}
                        </div>
                    </div>

                    <div class="component">
                        <h4>GET /api/promotions</h4>
                        <p><strong>Listar todas las promociones</strong></p>
                        <p>Query params: status, start_date, end_date, page, limit</p>
                    </div>

                    <div class="component">
                        <h4>GET /api/promotions/:id</h4>
                        <p><strong>Obtener detalle de promoci√≥n</strong></p>
                    </div>

                    <div class="component">
                        <h4>PUT /api/promotions/:id</h4>
                        <p><strong>Actualizar promoci√≥n</strong></p>
                        <p>Permite cambiar fechas, valor, productos aplicables (si no ha iniciado)</p>
                    </div>

                    <div class="component">
                        <h4>DELETE /api/promotions/:id</h4>
                        <p><strong>Eliminar/cancelar promoci√≥n</strong></p>
                    </div>

                    <div class="component">
                        <h4>POST /api/promotions/:id/activate</h4>
                        <p><strong>Activar manualmente</strong></p>
                    </div>

                    <div class="component">
                        <h4>POST /api/promotions/:id/pause</h4>
                        <p><strong>Pausar temporalmente</strong></p>
                    </div>
                </div>

                <div class="flow-diagram" style="margin-top: 30px;">
                    <h3>Consultas P√∫blicas</h3>
                    
                    <div class="component">
                        <h4>GET /api/promotions/active</h4>
                        <p><strong>Promociones activas ahora</strong></p>
                        <div class="code-block" style="font-size: 0.85em;">
<span class="comment">// Response</span>
{
  <span class="string">"promotions"</span>: [
    {
      <span class="string">"code"</span>: <span class="string">"NAVIDAD2025"</span>,
      <span class="string">"name"</span>: <span class="string">"Promoci√≥n Navidad"</span>,
      <span class="string">"discount"</span>: <span class="string">"25% OFF"</span>,
      <span class="string">"expires_at"</span>: <span class="string">"2025-12-26T23:59:59Z"</span>,
      <span class="string">"applies_to"</span>: <span class="string">"Ramos de amor y cumplea√±os"</span>
    }
  ]
}
                        </div>
                    </div>

                    <div class="component">
                        <h4>GET /api/products (con middleware)</h4>
                        <p><strong>Productos con precios promocionales aplicados</strong></p>
                        <div class="code-block" style="font-size: 0.85em;">
<span class="comment">// Response autom√°ticamente incluye:</span>
{
  <span class="string">"id"</span>: <span class="string">"AML001"</span>,
  <span class="string">"name"</span>: <span class="string">"Ramo Pasi√≥n Eterna"</span>,
  <span class="string">"price"</span>: <span class="number">35000</span>,
  <span class="string">"discount_price"</span>: <span class="number">26250</span>, <span class="comment">// 25% off</span>
  <span class="string">"discount_percentage"</span>: <span class="number">25</span>,
  <span class="string">"savings"</span>: <span class="number">8750</span>,
  <span class="string">"current_promotion"</span>: {
    <span class="string">"code"</span>: <span class="string">"NAVIDAD2025"</span>,
    <span class="string">"expires_at"</span>: <span class="string">"2025-12-26T23:59:59Z"</span>
  }
}
                        </div>
                    </div>

                    <div class="component">
                        <h4>GET /api/promotions/stats</h4>
                        <p><strong>Estad√≠sticas y analytics</strong></p>
                        <p>Conversiones, revenue, ROI por promoci√≥n</p>
                    </div>
                </div>
            </div>

            <!-- TAB: FRONTEND -->
            <div id="frontend" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 20px;">üé® Componentes Frontend</h2>
                
                <div class="architecture-diagram">
                    <div class="layer">
                        <h3><span class="icon">‚öôÔ∏è</span> Admin Panel</h3>
                        
                        <div class="component">
                            <h4>Formulario de Creaci√≥n</h4>
                            <p>Wizard paso a paso: tipo descuento ‚Üí productos/categor√≠as ‚Üí fechas ‚Üí condiciones</p>
                            <span class="tech">Form Validation</span>
                            <span class="tech">Date Picker</span>
                        </div>

                        <div class="component">
                            <h4>Vista Calendario</h4>
                            <p>Calendario mostrando todas las promociones programadas, activas y expiradas</p>
                            <span class="tech">FullCalendar.js</span>
                        </div>

                        <div class="component">
                            <h4>Dashboard Analytics</h4>
                            <p>Gr√°ficos de conversi√≥n, revenue, productos top en promoci√≥n</p>
                            <span class="tech">Chart.js</span>
                        </div>

                        <div class="component">
                            <h4>Preview en Vivo</h4>
                            <p>Vista previa de c√≥mo se ver√° el badge y precio en el frontend</p>
                            <span class="tech">Live Preview</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">üõçÔ∏è</span> Cat√°logo P√∫blico</h3>
                        
                        <div class="component">
                            <h4>ProductCard con Badge</h4>
                            <div class="code-block" style="font-size: 0.8em; margin-top: 10px;">
<span class="keyword">&lt;div</span> <span class="keyword">class=</span><span class="string">"product-card"</span><span class="keyword">&gt;</span>
  <span class="comment">&lt;!-- Badge de descuento --&gt;</span>
  <span class="keyword">&lt;div</span> <span class="keyword">class=</span><span class="string">"promo-badge"</span><span class="keyword">&gt;</span>-25%<span class="keyword">&lt;/div&gt;</span>
  
  <span class="comment">&lt;!-- Precios --&gt;</span>
  <span class="keyword">&lt;div</span> <span class="keyword">class=</span><span class="string">"prices"</span><span class="keyword">&gt;</span>
    <span class="keyword">&lt;span</span> <span class="keyword">class=</span><span class="string">"original-price"</span><span class="keyword">&gt;</span>$35.000<span class="keyword">&lt;/span&gt;</span>
    <span class="keyword">&lt;span</span> <span class="keyword">class=</span><span class="string">"discount-price"</span><span class="keyword">&gt;</span>$26.250<span class="keyword">&lt;/span&gt;</span>
    <span class="keyword">&lt;span</span> <span class="keyword">class=</span><span class="string">"savings"</span><span class="keyword">&gt;</span>Ahorras $8.750<span class="keyword">&lt;/span&gt;</span>
  <span class="keyword">&lt;/div&gt;</span>
  
  <span class="comment">&lt;!-- Countdown (opcional) --&gt;</span>
  <span class="keyword">&lt;div</span> <span class="keyword">class=</span><span class="string">"countdown"</span><span class="keyword">&gt;</span>
    ‚è±Ô∏è Termina en: 2d 5h 30m
  <span class="keyword">&lt;/div&gt;</span>
<span class="keyword">&lt;/div&gt;</span>
                            </div>
                        </div>

                        <div class="component">
                            <h4>P√°gina "Ofertas"</h4>
                            <p>Secci√≥n dedicada mostrando todos los productos en promoci√≥n con filtros</p>
                            <span class="tech">Filtros</span>
                            <span class="tech">Sorting</span>
                        </div>

                        <div class="component">
                            <h4>Banner Promocional</h4>
                            <p>Hero banner en homepage destacando la promo m√°s importante del momento</p>
                            <span class="tech">Responsive</span>
                            <span class="tech">Auto-rotate</span>
                        </div>
                    </div>

                    <div class="layer">
                        <h3><span class="icon">‚è±Ô∏è</span> Utilidades UI</h3>
                        
                        <div class="component">
                            <h4>Countdown Timer</h4>
                            <div class="code-block" style="font-size: 0.8em; margin-top: 10px;">
<span class="keyword">class</span> CountdownTimer {
  <span class="keyword">constructor</span>(endDate) {
    <span class="keyword">this</span>.endDate = <span class="keyword">new</span> Date(endDate);
    <span class="keyword">this</span>.update();
  }
  
  update() {
    <span class="keyword">const</span> now = <span class="keyword">new</span> Date();
    <span class="keyword">const</span> diff = <span class="keyword">this</span>.endDate - now;
    
    <span class="keyword">const</span> days = Math.floor(diff / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>));
    <span class="keyword">const</span> hours = Math.floor((diff % (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>)) / (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>));
    
    <span class="keyword">return</span> <span class="string">`${days}d ${hours}h`</span>;
  }
}
                            </div>
                        </div>

                        <div class="component">
                            <h4>PromoBadge Component</h4>
                            <p>Web component reutilizable para mostrar badges de descuento consistentemente</p>
                            <span class="tech">Custom Element</span>
                        </div>

                        <div class="component">
                            <h4>PriceDisplay Component</h4>
                            <p>Maneja formateo de precios con/sin descuento, tachado, formato CLP</p>
                            <span class="tech">Intl.NumberFormat</span>
                        </div>
                    </div>
                </div>

                <div class="success-box" style="margin-top: 30px;">
                    <h4>üé® Design System</h4>
                    <p><strong>Colores promocionales:</strong> Badge rojo (#e74c3c), precio tachado gris (#95a5a6), precio final verde (#27ae60), countdown naranja (#f39c12)</p>
                    <p><strong>Animaciones:</strong> Pulse en badge, slide-in en banner, fade countdown urgente</p>
                    <p><strong>Responsive:</strong> Badges adaptativos, countdown colapsable en mobile, tabla promos scrollable</p>
                </div>
            </div>

            <!-- TAB: TIMELINE -->
            <div id="timeline" class="tab-panel">
                <h2 style="color: #e74c3c; margin-bottom: 30px;">‚è±Ô∏è Plan de Implementaci√≥n</h2>
                
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 1: Fundamentos</h4>
                            <p><strong>Modelo y Schema:</strong> Crear Promotion model, extender Product model, √≠ndices MongoDB</p>
                            <p><strong>Servicio Base:</strong> CRUD b√°sico de promociones con validaciones</p>
                            <p><strong>Testing:</strong> Tests unitarios de modelos y validaciones</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 2: L√≥gica de Negocio</h4>
                            <p><strong>Price Calculator:</strong> Motor de c√°lculo con prioridades y m√∫ltiples promos</p>
                            <p><strong>Middleware:</strong> ApplyPromotions para interceptar productos</p>
                            <p><strong>Testing:</strong> Tests de c√°lculos, edge cases, conflictos</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 3: Automatizaci√≥n</h4>
                            <p><strong>Scheduler:</strong> Cron jobs con node-cron para activaci√≥n/expiraci√≥n</p>
                            <p><strong>Cache:</strong> Redis para promociones activas</p>
                            <p><strong>Notifications:</strong> Emails y WebSockets para alertas</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 4: Admin Panel</h4>
                            <p><strong>UI Creaci√≥n:</strong> Formulario wizard para crear/editar promos</p>
                            <p><strong>Vista Calendario:</strong> Timeline de promociones programadas</p>
                            <p><strong>Preview:</strong> Vista previa en vivo de c√≥mo se ver√°</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 5: Frontend P√∫blico</h4>
                            <p><strong>Product Cards:</strong> Badges, precios tachados, countdown</p>
                            <p><strong>P√°gina Ofertas:</strong> Cat√°logo de productos en promoci√≥n</p>
                            <p><strong>Banners:</strong> Hero banner promocional en home</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 6: Analytics & Polish</h4>
                            <p><strong>Dashboard:</strong> M√©tricas de conversi√≥n, ROI, revenue</p>
                            <p><strong>Testing E2E:</strong> Cypress tests de flujo completo</p>
                            <p><strong>Optimizaci√≥n:</strong> Performance, caching, indexing</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 7: Deploy & Monitoreo</h4>
                            <p><strong>Staging:</strong> Deploy en ambiente de pruebas</p>
                            <p><strong>UAT:</strong> Pruebas de usuario con data real</p>
                            <p><strong>Production:</strong> Deploy gradual con feature flags</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-marker"></div>
                        <div class="timeline-content">
                            <h4>Semana 8: Monitoreo & Ajustes</h4>
                            <p><strong>Observaci√≥n:</strong> Monitorear m√©tricas, logs, errores</p>
                            <p><strong>Feedback:</strong> Recolectar feedback de admins y usuarios</p>
                            <p><strong>Iteraci√≥n:</strong> Ajustes y mejoras basados en uso real</p>
                        </div>
                    </div>
                </div>

                <div class="stats" style="margin-top: 40px;">
                    <div class="stat-card">
                        <div class="value">8</div>
                        <div class="label">Semanas desarrollo</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">15+</div>
                        <div class="label">Componentes nuevos</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">3</div>
                        <div class="label">Servicios impactados</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">100%</div>
                        <div class="label">Test coverage objetivo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            // Ocultar todos los paneles
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Desactivar todos los tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activar el panel seleccionado
            document.getElementById(tabId).classList.add('active');
            
            // Activar el tab correspondiente
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
