%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#3B82F6',
    'primaryTextColor': '#1E40AF',
    'primaryBorderColor': '#2563EB',
    'lineColor': '#60A5FA',
    'tertiaryColor': '#EFF6FF',
    'fontFamily': 'Inter, Segoe UI, Arial, sans-serif',
    'fontSize': '12px'
  },
  'er': {
    'diagramPadding': 30,
    'layoutDirection': 'TB',
    'minEntityWidth': 150,
    'minEntityHeight': 100,
    'entityPadding': 20,
    'stroke': '#3B82F6',
    'fill': '#EFF6FF',
    'fontSize': '14px',
    'useMaxWidth': false
  }
}}%%

erDiagram
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ğŸŒ¸ FLORES VICTORIA - MODELO DE DATOS
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    USERS ||--o{ ORDERS : "realiza"
    USERS ||--o{ REVIEWS : "escribe"
    USERS ||--o{ WISHLISTS : "tiene"
    USERS ||--o{ ADDRESSES : "registra"
    USERS ||--o{ SESSIONS : "inicia"
    USERS ||--o{ CART : "posee"
    
    PRODUCTS ||--o{ ORDER_ITEMS : "incluido_en"
    PRODUCTS ||--o{ REVIEWS : "recibe"
    PRODUCTS ||--o{ CART_ITEMS : "agregado_a"
    PRODUCTS ||--o{ WISHLIST_ITEMS : "guardado_en"
    PRODUCTS }o--|| CATEGORIES : "pertenece_a"
    PRODUCTS ||--o{ PRODUCT_IMAGES : "tiene"
    
    ORDERS ||--|{ ORDER_ITEMS : "contiene"
    ORDERS ||--o| PAYMENTS : "tiene"
    ORDERS }o--|| ADDRESSES : "enviar_a"
    ORDERS ||--o{ ORDER_STATUS_HISTORY : "historial"
    
    PROMOTIONS ||--o{ ORDER_PROMOTIONS : "aplicada_a"
    ORDERS ||--o{ ORDER_PROMOTIONS : "usa"
    
    CART ||--|{ CART_ITEMS : "contiene"
    WISHLISTS ||--|{ WISHLIST_ITEMS : "contiene"

    USERS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        varchar(255) email UK "ğŸ“§ Email Ãºnico"
        varchar(255) password_hash "ğŸ”’ Hash bcrypt"
        varchar(100) first_name "ğŸ‘¤ Nombre"
        varchar(100) last_name "ğŸ‘¤ Apellido"
        varchar(20) phone "ğŸ“± TelÃ©fono"
        enum role "ğŸ­ admin|customer"
        boolean email_verified "âœ“ Verificado"
        boolean is_active "âœ“ Activo"
        timestamp last_login "ğŸ• Ãšltimo acceso"
        timestamp created_at "ğŸ“… CreaciÃ³n"
        timestamp updated_at "ğŸ“… ActualizaciÃ³n"
    }

    PRODUCTS {
        objectId _id PK "ğŸ”‘ MongoDB ID"
        varchar(255) name "ğŸŒ· Nombre"
        text description "ğŸ“ DescripciÃ³n"
        decimal(10_2) price "ğŸ’° Precio base"
        decimal(10_2) sale_price "ğŸ·ï¸ Precio oferta"
        int stock "ğŸ“¦ Inventario"
        varchar(50) sku UK "ğŸ·ï¸ CÃ³digo SKU"
        objectId category_id FK "ğŸ“‚ CategorÃ­a"
        array tags "ğŸ·ï¸ Etiquetas"
        boolean is_active "âœ“ Activo"
        boolean is_featured "â­ Destacado"
        int views_count "ğŸ‘ï¸ Vistas"
        decimal(3_2) avg_rating "â­ Rating"
        timestamp created_at "ğŸ“… CreaciÃ³n"
    }

    CATEGORIES {
        objectId _id PK "ğŸ”‘ MongoDB ID"
        varchar(100) name "ğŸ“‚ Nombre"
        varchar(100) slug UK "ğŸ”— URL amigable"
        text description "ğŸ“ DescripciÃ³n"
        varchar(500) image_url "ğŸ–¼ï¸ Imagen"
        objectId parent_id FK "ğŸ“‚ CategorÃ­a padre"
        int sort_order "ğŸ“Š Orden"
        boolean is_active "âœ“ Activo"
    }

    ORDERS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        varchar(20) order_number UK "ğŸ“‹ NÃºmero pedido"
        uuid user_id FK "ğŸ‘¤ Usuario"
        uuid shipping_address_id FK "ğŸ“ DirecciÃ³n"
        decimal(10_2) subtotal "ğŸ’° Subtotal"
        decimal(10_2) shipping_cost "ğŸšš EnvÃ­o"
        decimal(10_2) discount_amount "ğŸ·ï¸ Descuento"
        decimal(10_2) tax_amount "ğŸ“Š Impuestos"
        decimal(10_2) total "ğŸ’° Total"
        enum status "ğŸ“Š Estado pedido"
        enum payment_status "ğŸ’³ Estado pago"
        text customer_notes "ğŸ“ Notas cliente"
        text admin_notes "ğŸ“ Notas admin"
        varchar(100) delivery_slot "ğŸ• Horario entrega"
        timestamp estimated_delivery "ğŸ“… Entrega estimada"
        timestamp shipped_at "ğŸ“… Enviado"
        timestamp delivered_at "ğŸ“… Entregado"
        timestamp created_at "ğŸ“… CreaciÃ³n"
    }

    ORDER_ITEMS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid order_id FK "ğŸ“‹ Pedido"
        varchar(50) product_id FK "ğŸŒ· Producto"
        varchar(255) product_name "ğŸ“ Nombre snapshot"
        varchar(500) product_image "ğŸ–¼ï¸ Imagen snapshot"
        decimal(10_2) unit_price "ğŸ’° Precio unitario"
        int quantity "ğŸ“¦ Cantidad"
        decimal(10_2) subtotal "ğŸ’° Subtotal lÃ­nea"
        text customization "âœï¸ PersonalizaciÃ³n"
    }

    ORDER_STATUS_HISTORY {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid order_id FK "ğŸ“‹ Pedido"
        enum status "ğŸ“Š Estado"
        text notes "ğŸ“ Notas"
        uuid changed_by FK "ğŸ‘¤ Cambiado por"
        timestamp created_at "ğŸ“… Fecha cambio"
    }

    REVIEWS {
        objectId _id PK "ğŸ”‘ MongoDB ID"
        uuid user_id FK "ğŸ‘¤ Usuario"
        objectId product_id FK "ğŸŒ· Producto"
        int rating "â­ 1-5 estrellas"
        varchar(200) title "ğŸ“ TÃ­tulo"
        text comment "ğŸ’¬ Comentario"
        array images "ğŸ–¼ï¸ Fotos"
        boolean verified_purchase "âœ“ Compra verificada"
        int helpful_votes "ğŸ‘ Votos Ãºtiles"
        boolean is_approved "âœ“ Aprobado"
        timestamp created_at "ğŸ“… CreaciÃ³n"
    }

    ADDRESSES {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid user_id FK "ğŸ‘¤ Usuario"
        varchar(50) label "ğŸ·ï¸ Etiqueta"
        varchar(255) recipient_name "ğŸ‘¤ Destinatario"
        varchar(255) street_line1 "ğŸ“ Calle"
        varchar(255) street_line2 "ğŸ“ Interior/Depto"
        varchar(100) city "ğŸ™ï¸ Ciudad"
        varchar(100) state "ğŸ“ Estado"
        varchar(20) postal_code "ğŸ“® CP"
        varchar(100) country "ğŸŒ PaÃ­s"
        varchar(20) phone "ğŸ“± TelÃ©fono"
        text delivery_instructions "ğŸ“ Instrucciones"
        decimal(10_6) latitude "ğŸ“ Latitud"
        decimal(10_6) longitude "ğŸ“ Longitud"
        boolean is_default "â­ Predeterminada"
    }

    PAYMENTS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid order_id FK "ğŸ“‹ Pedido"
        varchar(100) stripe_payment_id UK "ğŸ’³ Stripe ID"
        varchar(100) stripe_customer_id "ğŸ‘¤ Stripe Customer"
        enum method "ğŸ’³ card|transfer|cash"
        decimal(10_2) amount "ğŸ’° Monto"
        varchar(3) currency "ğŸ’± Moneda"
        enum status "ğŸ“Š Estado"
        varchar(50) card_last4 "ğŸ’³ Ãšltimos 4"
        varchar(50) card_brand "ğŸ’³ Marca"
        json metadata "ğŸ“‹ Metadata"
        text failure_reason "âŒ RazÃ³n fallo"
        timestamp created_at "ğŸ“… CreaciÃ³n"
        timestamp confirmed_at "ğŸ“… ConfirmaciÃ³n"
    }

    WISHLISTS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid user_id FK "ğŸ‘¤ Usuario"
        varchar(100) name "ğŸ“ Nombre lista"
        boolean is_public "ğŸ‘ï¸ PÃºblica"
        timestamp created_at "ğŸ“… CreaciÃ³n"
    }

    WISHLIST_ITEMS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid wishlist_id FK "â¤ï¸ Lista"
        varchar(50) product_id FK "ğŸŒ· Producto"
        text notes "ğŸ“ Notas"
        timestamp added_at "ğŸ“… Agregado"
    }

    SESSIONS {
        varchar(255) id PK "ğŸ”‘ Session ID"
        uuid user_id FK "ğŸ‘¤ Usuario"
        text token "ğŸ« JWT Token"
        varchar(45) ip_address "ğŸŒ IP"
        varchar(500) user_agent "ğŸ’» Navegador"
        json device_info "ğŸ“± Dispositivo"
        timestamp expires_at "â° ExpiraciÃ³n"
        timestamp created_at "ğŸ“… CreaciÃ³n"
    }

    CART {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid user_id FK "ğŸ‘¤ Usuario"
        varchar(100) session_id "ğŸ”‘ Session ID"
        decimal(10_2) subtotal "ğŸ’° Subtotal"
        timestamp expires_at "â° ExpiraciÃ³n"
        timestamp updated_at "ğŸ“… ActualizaciÃ³n"
    }

    CART_ITEMS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid cart_id FK "ğŸ›’ Carrito"
        varchar(50) product_id FK "ğŸŒ· Producto"
        int quantity "ğŸ“¦ Cantidad"
        decimal(10_2) price_snapshot "ğŸ’° Precio al agregar"
        text customization "âœï¸ PersonalizaciÃ³n"
        timestamp added_at "ğŸ“… Agregado"
    }

    PROMOTIONS {
        objectId _id PK "ğŸ”‘ MongoDB ID"
        varchar(50) code UK "ğŸ·ï¸ CÃ³digo"
        varchar(255) name "ğŸ“ Nombre"
        text description "ğŸ“ DescripciÃ³n"
        enum type "ğŸ“Š percentage|fixed|shipping"
        decimal(10_2) value "ğŸ’° Valor"
        decimal(10_2) min_purchase "ğŸ’° Compra mÃ­nima"
        decimal(10_2) max_discount "ğŸ’° Descuento mÃ¡ximo"
        int max_uses "ğŸ“Š Usos mÃ¡ximos"
        int max_uses_per_user "ğŸ“Š Usos por usuario"
        int current_uses "ğŸ“Š Usos actuales"
        array applicable_products "ğŸŒ· Productos"
        array applicable_categories "ğŸ“‚ CategorÃ­as"
        timestamp start_date "ğŸ“… Inicio"
        timestamp end_date "ğŸ“… Fin"
        boolean is_active "âœ“ Activo"
    }

    ORDER_PROMOTIONS {
        uuid id PK "ğŸ”‘ ID Ãºnico"
        uuid order_id FK "ğŸ“‹ Pedido"
        varchar(50) promotion_id FK "ğŸ·ï¸ PromociÃ³n"
        varchar(50) code_used "ğŸ·ï¸ CÃ³digo usado"
        decimal(10_2) discount_applied "ğŸ’° Descuento"
    }

    PRODUCT_IMAGES {
        objectId _id PK "ğŸ”‘ MongoDB ID"
        objectId product_id FK "ğŸŒ· Producto"
        varchar(500) url "ğŸ”— URL"
        varchar(500) thumbnail_url "ğŸ”— Thumbnail"
        varchar(255) alt_text "ğŸ“ Alt text"
        int sort_order "ğŸ“Š Orden"
        boolean is_primary "â­ Principal"
    }
