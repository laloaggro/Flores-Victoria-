%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#6366F1',
    'primaryTextColor': '#FFFFFF',
    'primaryBorderColor': '#4F46E5',
    'secondaryColor': '#C7D2FE',
    'secondaryTextColor': '#3730A3',
    'secondaryBorderColor': '#818CF8',
    'tertiaryColor': '#EEF2FF',
    'tertiaryTextColor': '#4338CA',
    'tertiaryBorderColor': '#A5B4FC',
    'lineColor': '#6366F1',
    'textColor': '#1F2937',
    'mainBkg': '#F5F3FF',
    'nodeBorder': '#6366F1',
    'clusterBkg': '#EEF2FF',
    'clusterBorder': '#A5B4FC',
    'titleColor': '#3730A3',
    'fontFamily': 'Inter, Segoe UI, Arial, sans-serif',
    'fontSize': '14px'
  },
  'flowchart': {
    'htmlLabels': true,
    'curve': 'basis',
    'rankSpacing': 70,
    'nodeSpacing': 50,
    'padding': 20,
    'useMaxWidth': false
  }
}}%%

flowchart TB
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ğŸŒ¸ FLORES VICTORIA - INFRAESTRUCTURA EN RAILWAY
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    subgraph INTERNET["<b>ğŸŒ INTERNET</b>"]
        direction LR
        USERS["<b>ğŸ‘¥ Usuarios</b><br/><i>Clientes & Admin</i>"]
        CDN["<b>â˜ï¸ Cloudflare CDN</b><br/><i>Cache & DDoS Protection</i>"]
    end

    subgraph RAILWAY["<b>â˜ï¸ RAILWAY CLOUD PLATFORM</b>"]
        
        subgraph LB["<b>âš–ï¸ LOAD BALANCING</b>"]
            RAIL_LB["<b>ğŸ”€ Railway Ingress</b><br/><i>Load Balancer AutomÃ¡tico</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>SSL/TLS Termination<br/>Auto-scaling<br/>Health Checks"]
        end

        subgraph FRONT_TIER["<b>ğŸ¨ FRONTEND TIER</b>"]
            direction LR
            FE_R["<b>ğŸŒ¸ frontend-v2-production</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Static Site + Vite</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Replicas: 1<br/>ğŸ’¾ Memory: 512MB<br/>ğŸ”— floresvictoria.com"]
            
            ADMIN_R["<b>ğŸ“Š admin-panel</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Express + Dashboard</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Replicas: 1<br/>ğŸ’¾ Memory: 256MB<br/>ğŸ”— admin.floresvictoria.com"]
        end

        subgraph API_TIER["<b>ğŸšª API GATEWAY TIER</b>"]
            GW_R["<b>âš¡ api-gateway-production</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Express.js Gateway</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ JWT Verification<br/>âœ“ Rate Limiting (100/min)<br/>âœ“ Request Logging<br/>âœ“ CORS Management<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Replicas: 1 | ğŸ’¾ 512MB<br/>ğŸ”— api.floresvictoria.com"]
        end

        subgraph SERVICES_TIER["<b>âš™ï¸ MICROSERVICES TIER</b>"]
            direction TB
            
            subgraph AUTH_SVC["<b>ğŸ” Auth & Users</b>"]
                direction LR
                AUTH_R["<b>ğŸ” auth-service</b><br/>JWT â€¢ bcrypt<br/>ğŸ’¾ 256MB"]
                USER_R["<b>ğŸ‘¤ user-service</b><br/>Profiles<br/>ğŸ’¾ 256MB"]
            end

            subgraph COMMERCE_SVC["<b>ğŸ›ï¸ Commerce</b>"]
                direction LR
                PROD_R["<b>ğŸŒ· product-service</b><br/>Catalog<br/>ğŸ’¾ 256MB"]
                CART_R["<b>ğŸ›’ cart-service</b><br/>Sessions<br/>ğŸ’¾ 128MB"]
                ORDER_R["<b>ğŸ“‹ order-service</b><br/>Orders<br/>ğŸ’¾ 256MB"]
            end

            subgraph ENGAGE_SVC["<b>ğŸ’œ Engagement</b>"]
                direction LR
                WISH_R["<b>â¤ï¸ wishlist-service</b><br/>Favorites<br/>ğŸ’¾ 128MB"]
                REV_R["<b>â­ review-service</b><br/>Reviews<br/>ğŸ’¾ 128MB"]
                NOTIF_R["<b>ğŸ”” notification-svc</b><br/>Email/SMS<br/>ğŸ’¾ 256MB"]
            end

            subgraph SUPPORT_SVC["<b>ğŸ“¬ Support</b>"]
                direction LR
                CONT_R["<b>ğŸ“ contact-service</b><br/>Support<br/>ğŸ’¾ 128MB"]
            end
        end

        subgraph DATA_TIER["<b>ğŸ’¾ DATA TIER</b>"]
            direction LR
            PG_R["<b>ğŸ˜ PostgreSQL</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Railway Plugin</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Version: 16<br/>ğŸ’¾ Storage: 1GB<br/>ğŸ”— Connections: 25<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ users<br/>â€¢ orders<br/>â€¢ payments<br/>â€¢ addresses"]
            
            MONGO_R["<b>ğŸƒ MongoDB</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Railway Plugin</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Version: 7.0<br/>ğŸ’¾ Storage: 1GB<br/>ğŸ”— Replica Set<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ products<br/>â€¢ reviews<br/>â€¢ categories<br/>â€¢ promotions"]
            
            REDIS_R["<b>âš¡ Redis</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>Railway Plugin</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Version: 7<br/>ğŸ’¾ Memory: 25MB<br/>ğŸ”„ Eviction: LRU<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ sessions<br/>â€¢ cart cache<br/>â€¢ rate limits"]
        end
    end

    subgraph GITHUB["<b>ğŸ“¦ SOURCE CONTROL</b>"]
        REPO["<b>ğŸ“ GitHub Repository</b><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/><i>laloaggro/Flores-Victoria-</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸŒ¿ Branch: main<br/>ğŸ”„ Auto-deploy: âœ“<br/>ğŸ›¡ï¸ Branch protection: âœ“"]
    end

    subgraph EXTERNAL["<b>ğŸ”Œ EXTERNAL INTEGRATIONS</b>"]
        direction LR
        STRIPE_E["<b>ğŸ’° Stripe</b><br/><i>Payment Processing</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Cards â€¢ OXXO<br/>SPEI â€¢ Apple Pay"]
        MAILGUN_E["<b>ğŸ“§ Mailgun</b><br/><i>Transactional Email</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Confirmations<br/>Notifications"]
        SENTRY_E["<b>ğŸ› Sentry</b><br/><i>Error Tracking</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Monitoring<br/>Alerts"]
    end

    %% â•â•â• CONEXIONES â•â•â•

    USERS -->|"HTTPS"| CDN
    CDN -->|"HTTPS"| RAIL_LB
    
    RAIL_LB --> FE_R
    RAIL_LB --> ADMIN_R
    RAIL_LB --> GW_R

    GW_R --> AUTH_R
    GW_R --> USER_R
    GW_R --> PROD_R
    GW_R --> CART_R
    GW_R --> ORDER_R
    GW_R --> WISH_R
    GW_R --> REV_R
    GW_R --> NOTIF_R
    GW_R --> CONT_R

    AUTH_R --> PG_R
    AUTH_R --> REDIS_R
    USER_R --> PG_R
    PROD_R --> MONGO_R
    CART_R --> REDIS_R
    ORDER_R --> PG_R
    WISH_R --> REDIS_R
    REV_R --> MONGO_R
    CONT_R --> PG_R

    ORDER_R -.->|"Webhook"| STRIPE_E
    NOTIF_R -.->|"API"| MAILGUN_E
    GW_R -.->|"Errors"| SENTRY_E

    REPO -->|"Push trigger"| RAILWAY

    %% â•â•â• ESTILOS â•â•â•
    
    classDef userStyle fill:#E0E7FF,stroke:#6366F1,stroke-width:2px,color:#3730A3
    classDef lbStyle fill:#6366F1,stroke:#4338CA,stroke-width:3px,color:#FFFFFF
    classDef frontStyle fill:#C7D2FE,stroke:#818CF8,stroke-width:2px,color:#3730A3
    classDef gwStyle fill:#4F46E5,stroke:#3730A3,stroke-width:3px,color:#FFFFFF
    classDef svcStyle fill:#E0E7FF,stroke:#6366F1,stroke-width:2px,color:#3730A3
    classDef dataStyle fill:#F5F3FF,stroke:#A5B4FC,stroke-width:2px,color:#4338CA
    classDef extStyle fill:#FEF3C7,stroke:#F59E0B,stroke-width:2px,color:#92400E
    classDef repoStyle fill:#DCFCE7,stroke:#22C55E,stroke-width:2px,color:#166534

    class USERS,CDN userStyle
    class RAIL_LB lbStyle
    class FE_R,ADMIN_R frontStyle
    class GW_R gwStyle
    class AUTH_R,USER_R,PROD_R,CART_R,ORDER_R,WISH_R,REV_R,NOTIF_R,CONT_R svcStyle
    class PG_R,MONGO_R,REDIS_R dataStyle
    class STRIPE_E,MAILGUN_E,SENTRY_E extStyle
    class REPO repoStyle
