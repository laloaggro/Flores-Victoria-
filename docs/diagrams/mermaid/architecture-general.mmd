%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#9333EA',
    'primaryTextColor': '#FFFFFF',
    'primaryBorderColor': '#7E22CE',
    'secondaryColor': '#F0ABFC',
    'secondaryTextColor': '#581C87',
    'secondaryBorderColor': '#D946EF',
    'tertiaryColor': '#FDF4FF',
    'tertiaryTextColor': '#701A75',
    'tertiaryBorderColor': '#E879F9',
    'lineColor': '#A855F7',
    'textColor': '#1F2937',
    'mainBkg': '#FAF5FF',
    'nodeBorder': '#9333EA',
    'clusterBkg': '#F3E8FF',
    'clusterBorder': '#C084FC',
    'titleColor': '#581C87',
    'edgeLabelBackground': '#FFFFFF',
    'fontFamily': 'Inter, Segoe UI, Arial, sans-serif',
    'fontSize': '14px'
  },
  'flowchart': {
    'htmlLabels': true,
    'curve': 'basis',
    'rankSpacing': 80,
    'nodeSpacing': 60,
    'padding': 20,
    'useMaxWidth': false
  }
}}%%

flowchart TB
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% ğŸŒ¸ FLORES VICTORIA - ARQUITECTURA DEL SISTEMA
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    subgraph CLIENTS["<b>ğŸŒ CAPA DE CLIENTES</b>"]
        direction LR
        WEB["<b>ğŸ’» Navegador Web</b><br/><i>Desktop & Mobile</i>"]
        MOBILE["<b>ğŸ“± App MÃ³vil</b><br/><i>iOS & Android</i>"]
        ADMIN_C["<b>ğŸ‘¨â€ğŸ’¼ Administrador</b><br/><i>Panel de Control</i>"]
    end

    subgraph FRONTEND["<b>ğŸ¨ CAPA DE PRESENTACIÃ“N</b>"]
        direction LR
        FE["<b>ğŸŒ¸ Flores Victoria</b><br/><i>Frontend SPA</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>HTML5 â€¢ CSS3 â€¢ JS<br/>Puerto: 5173"]
        AP["<b>ğŸ“Š Panel Admin</b><br/><i>Dashboard</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Express.js<br/>Puerto: 3021"]
    end

    subgraph GATEWAY["<b>ğŸšª API GATEWAY</b>"]
        GW["<b>âš¡ Gateway Central</b><br/><i>Punto de Entrada Ãšnico</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ Rate Limiting<br/>âœ“ JWT Validation<br/>âœ“ Request Routing<br/>âœ“ Load Balancing<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Express.js â€¢ Puerto: 3000"]
    end

    subgraph SERVICES["<b>âš™ï¸ MICROSERVICIOS</b>"]
        direction TB
        
        subgraph AUTH_LAYER["<b>ğŸ” Seguridad & Usuarios</b>"]
            direction LR
            AUTH["<b>ğŸ” Auth</b><br/><i>AutenticaciÃ³n</i><br/>JWT â€¢ bcrypt<br/>:3001"]
            USER["<b>ğŸ‘¤ Users</b><br/><i>Perfiles</i><br/>CRUD Users<br/>:3002"]
        end

        subgraph COMMERCE_LAYER["<b>ğŸ›ï¸ Comercio ElectrÃ³nico</b>"]
            direction LR
            PROD["<b>ğŸŒ· Products</b><br/><i>CatÃ¡logo</i><br/>Inventario<br/>:3009"]
            CART["<b>ğŸ›’ Cart</b><br/><i>Carrito</i><br/>Sesiones<br/>:3004"]
            ORDER["<b>ğŸ“‹ Orders</b><br/><i>Pedidos</i><br/>Tracking<br/>:3005"]
            PAY["<b>ğŸ’³ Payments</b><br/><i>Pagos</i><br/>Stripe<br/>:3018"]
        end

        subgraph ENGAGEMENT_LAYER["<b>ğŸ’œ Engagement</b>"]
            direction LR
            WISH["<b>â¤ï¸ Wishlist</b><br/><i>Favoritos</i><br/>:3006"]
            REV["<b>â­ Reviews</b><br/><i>ReseÃ±as</i><br/>:3007"]
            PROMO["<b>ğŸ Promos</b><br/><i>Descuentos</i><br/>:3019"]
        end

        subgraph COMM_LAYER["<b>ğŸ“¬ ComunicaciÃ³n</b>"]
            direction LR
            CONT["<b>ğŸ“ Contact</b><br/><i>Soporte</i><br/>:3008"]
            NOTIF["<b>ğŸ”” Notify</b><br/><i>Email/SMS</i><br/>:3010"]
        end
    end

    subgraph DATA["<b>ğŸ’¾ CAPA DE DATOS</b>"]
        direction LR
        PG["<b>ğŸ˜ PostgreSQL</b><br/><i>Base Relacional</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Usuarios<br/>â€¢ Pedidos<br/>â€¢ Pagos<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Puerto: 5432"]
        MONGO["<b>ğŸƒ MongoDB</b><br/><i>Base NoSQL</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Productos<br/>â€¢ ReseÃ±as<br/>â€¢ Promos<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Puerto: 27017"]
        REDIS["<b>âš¡ Redis</b><br/><i>Cache & Sessions</i><br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Sesiones<br/>â€¢ Carrito<br/>â€¢ Rate Limit<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Puerto: 6379"]
    end

    subgraph EXTERNAL["<b>ğŸŒ SERVICIOS EXTERNOS</b>"]
        direction LR
        STRIPE["<b>ğŸ’° Stripe</b><br/><i>Procesador de Pagos</i>"]
        MAILGUN["<b>ğŸ“§ Mailgun</b><br/><i>Email Transaccional</i>"]
        TWILIO["<b>ğŸ“± Twilio</b><br/><i>SMS & WhatsApp</i>"]
    end

    %% â•â•â• CONEXIONES â•â•â•
    
    WEB --> FE
    MOBILE --> GW
    ADMIN_C --> AP

    FE --> GW
    AP --> GW

    GW --> AUTH
    GW --> USER
    GW --> PROD
    GW --> CART
    GW --> ORDER
    GW --> PAY
    GW --> WISH
    GW --> REV
    GW --> PROMO
    GW --> CONT
    GW --> NOTIF

    AUTH --> PG
    AUTH --> REDIS
    USER --> PG
    CART --> REDIS
    ORDER --> PG
    WISH --> REDIS
    PROD --> MONGO
    REV --> MONGO
    PROMO --> MONGO
    CONT --> PG
    PAY --> PG

    PAY -.->|"API"| STRIPE
    NOTIF -.->|"API"| MAILGUN
    NOTIF -.->|"API"| TWILIO

    %% â•â•â• ESTILOS PROFESIONALES â•â•â•
    
    classDef clientStyle fill:#E9D5FF,stroke:#9333EA,stroke-width:2px,color:#581C87,rx:10,ry:10
    classDef frontendStyle fill:#F0ABFC,stroke:#C026D3,stroke-width:2px,color:#701A75,rx:10,ry:10
    classDef gatewayStyle fill:#9333EA,stroke:#6B21A8,stroke-width:3px,color:#FFFFFF,rx:15,ry:15
    classDef serviceStyle fill:#D8B4FE,stroke:#A855F7,stroke-width:2px,color:#581C87,rx:8,ry:8
    classDef dataStyle fill:#FDF4FF,stroke:#E879F9,stroke-width:2px,color:#701A75,rx:50,ry:50
    classDef externalStyle fill:#FEF3C7,stroke:#F59E0B,stroke-width:2px,color:#92400E,rx:10,ry:10

    class WEB,MOBILE,ADMIN_C clientStyle
    class FE,AP frontendStyle
    class GW gatewayStyle
    class AUTH,USER,PROD,CART,ORDER,PAY,WISH,REV,PROMO,CONT,NOTIF serviceStyle
    class PG,MONGO,REDIS dataStyle
    class STRIPE,MAILGUN,TWILIO externalStyle
