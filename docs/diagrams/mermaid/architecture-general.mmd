%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#8B5CF6', 'primaryTextColor': '#fff', 'primaryBorderColor': '#7C3AED', 'lineColor': '#6D28D9', 'secondaryColor': '#F3E8FF', 'tertiaryColor': '#EDE9FE', 'background': '#FAFAFA'}}}%%
flowchart TB
    subgraph CLIENTS["ğŸ‘¥ CLIENTES"]
        direction LR
        WEB["ğŸŒ Web Browser"]
        MOBILE["ğŸ“± Mobile App"]
        ADMIN_C["ğŸ‘¨â€ğŸ’¼ Admin"]
    end

    subgraph FRONTEND["ğŸ¨ FRONTEND LAYER"]
        direction LR
        FE["ğŸ¨ Frontend<br/>HTML/CSS/JS<br/>Puerto: 5173"]
        AP["ğŸ“Š Admin Panel<br/>Puerto: 3021"]
    end

    subgraph GATEWAY["ğŸšª API GATEWAY"]
        GW["ğŸšª API Gateway<br/>Express.js + Rate Limiting<br/>Puerto: 3000"]
    end

    subgraph SERVICES["âš™ï¸ MICROSERVICES LAYER"]
        direction TB
        subgraph AUTH_GROUP["AutenticaciÃ³n"]
            AUTH["ğŸ” Auth Service<br/>:3001"]
            USER["ğŸ‘¤ User Service<br/>:3002"]
        end
        subgraph COMMERCE["Comercio"]
            PROD["ğŸ“¦ Product Service<br/>:3009"]
            CART["ğŸ›’ Cart Service<br/>:3004"]
            ORDER["ğŸ“‹ Order Service<br/>:3005"]
            PAY["ğŸ’³ Payment Service<br/>:3018"]
        end
        subgraph ENGAGEMENT["Engagement"]
            WISH["â¤ï¸ Wishlist<br/>:3006"]
            REV["â­ Reviews<br/>:3007"]
            PROMO["ğŸ Promotions<br/>:3019"]
        end
        subgraph COMM["ComunicaciÃ³n"]
            CONT["ğŸ“ Contact<br/>:3008"]
            NOTIF["ğŸ”” Notifications<br/>:3010"]
        end
    end

    subgraph DATA["ğŸ’¾ DATA LAYER"]
        direction LR
        PG[("ğŸ˜ PostgreSQL<br/>Users, Orders<br/>Puerto: 5432")]
        MONGO[("ğŸƒ MongoDB<br/>Products, Reviews<br/>Puerto: 27017")]
        REDIS[("âš¡ Redis<br/>Cache, Sessions<br/>Puerto: 6379")]
    end

    subgraph EXTERNAL["ğŸŒ EXTERNAL SERVICES"]
        direction LR
        STRIPE["ğŸ’° Stripe<br/>Payments"]
        MAILGUN["ğŸ“§ Mailgun<br/>Emails"]
        TWILIO["ğŸ“± Twilio<br/>SMS"]
    end

    WEB --> FE
    MOBILE --> GW
    ADMIN_C --> AP

    FE --> GW
    AP --> GW

    GW --> AUTH
    GW --> USER
    GW --> PROD
    GW --> CART
    GW --> ORDER
    GW --> PAY
    GW --> WISH
    GW --> REV
    GW --> PROMO
    GW --> CONT
    GW --> NOTIF

    AUTH --> PG
    AUTH --> REDIS
    USER --> PG
    CART --> REDIS
    ORDER --> PG
    WISH --> REDIS
    PROD --> MONGO
    REV --> MONGO
    PROMO --> MONGO
    CONT --> PG
    PAY --> PG

    PAY -.-> STRIPE
    NOTIF -.-> MAILGUN
    NOTIF -.-> TWILIO
